// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

main()
{
    scripts\stealth\manager::main();
    level.player thread scripts\stealth\manager::update_stealth_spotted_thread();
    level thread scripts\stealth\manager::manager_thread();

    if ( getdvarint( "dvar_6109644D57E1122E" ) )
        _id_26265E158B27BDDA::stealth_suspicious_doors_init();

    level.stealth.fnplayerlootenabled = scripts\sp\utility::playerlootenabled;
    level.stealth.fnsetbattlechatter = scripts\engine\sp\utility::set_battlechatter;
    level.stealth.fnaddeventplaybcs = _id_35DE402EFC5ACFB3::addeventplaybcs;
    level.stealth.fnanimgenericcustomanimmode = scripts\sp\anim::anim_generic_custom_animmode;
    level.stealth.fnthreatsightplayersightaudio = ::threat_sight_player_sight_audio;
    level.stealth._id_585390079B597CD6 = ::_id_9B25540DA1B89219;
    level notify( "threat_sight_audio_enabled" );
    level.stealth.fnsetstealthmode = ::set_stealth_mode_sp;
    setdvarifuninitialized( "dvar_50363B4004713D67", 0 );
    setdvarifuninitialized( "dvar_82EB856681438F08", 1 );
    setdvarifuninitialized( "dvar_3A810DB500922B6C", 0 );

    if ( getdvarint( "dvar_50363B4004713D67" ) )
        level.stealth._id_84CC26FCABCAFCE7 = scripts\sp\stealth\player::_id_9856971A6BDA1BEA;

    _func_F35CC6439852EE86( [ level.player ] );
    scripts\game\sp\stealth\manager::init();
    _id_3212CC02A2700260::bctable_setfiles( "stealth", "sp/stealth_chatter_base.csv", "sp/stealth_chatter_ambient.csv" );
}

set_stealth_mode_sp( enabled, _id_BD2621A5F467FE6C, _id_A1F4D479A8C138CD )
{
    if ( enabled )
    {
        foreach ( player in level.players )
            player thread scripts\sp\stealth\player::ambient_player_thread();
    }
    else
    {
        foreach ( player in level.players )
            player thread scripts\sp\stealth\player::ambient_player_stop();
    }
}

threat_sight_player_sight_audio( _id_5A80AEB955D466DC, maxthreat, _id_67E8151F4DFC690B )
{
    self endon( "disconnect" );
    self endon( "death" );
    self notify( "threat_sight_player_sight_audio" );
    self endon( "threat_sight_player_sight_audio" );
    level endon( "threat_sight_audio_disabled" );
    aliases = [ "ui_stealth_threat_low_lp", "ui_stealth_threat_med_lp", "ui_stealth_threat_high_lp" ];
    rumble = "damage_light";

    if ( !getdvarint( "dvar_21B72D8C9FF7A1B3", 0 ) )
        maxthreat = 0;

    if ( !isdefined( self.stealth.threat_sight_snd_ent ) && _id_5A80AEB955D466DC && maxthreat > 0 )
    {
        self.stealth.threat_sight_snd_ent = [];
        self.stealth.threat_sight_snd_vol = 0.0;
        self.stealth.threat_sight_snd_threat = 0.0;

        foreach ( index, alias in aliases )
        {
            _id_D4479D622A4F5606 = spawn( "script_origin", self.origin );

            if ( !isplayer( self ) )
                thread scripts\engine\utility::delete_on_death( _id_D4479D622A4F5606 );

            _id_D4479D622A4F5606 linkto( self );
            _id_D4479D622A4F5606 _meth_F4604329F388A96F( 0, 0.0 );
            _id_D4479D622A4F5606.isplaying = 0;
            self.stealth.threat_sight_snd_ent[alias] = _id_D4479D622A4F5606;
        }
    }

    if ( isdefined( self.stealth.threat_sight_snd_ent ) )
    {
        self.stealth.threat_sight_snd_threat = self.stealth.threat_sight_snd_threat - self.stealth.threat_sight_snd_threat * 0.125;
        self.stealth.threat_sight_snd_threat = self.stealth.threat_sight_snd_threat + maxthreat * 0.125;

        if ( self.stealth.threat_sight_snd_threat < 0.0001 )
            self.stealth.threat_sight_snd_threat = 0.0;

        maxthreat = self.stealth.threat_sight_snd_threat;
    }

    while ( isdefined( self.stealth.threat_sight_snd_ent ) )
    {
        index = 0;
        _id_CFAEEEA72851152D = 0;

        if ( maxthreat > 0 )
        {
            _id_1CDA86ECCB821EC6 = _func_8BA164C5A84FBB48( self );

            if ( maxthreat < 0.05 )
            {
                _id_2DF1B1F3E5B6238C = clamp( maxthreat, 0, 0.05 );
                _id_CE432C78F5984633 = _id_2DF1B1F3E5B6238C / 0.05;
                _id_97463E5FAE955EAB = 0.99;
                _id_11AF093D4B19EAB2 = 0.01 + _id_97463E5FAE955EAB * _id_CE432C78F5984633;
                self.stealth.threat_sight_snd_vol = _id_11AF093D4B19EAB2;
            }
            else
                self.stealth.threat_sight_snd_vol = 1.0;
        }
        else
        {
            self.stealth.threat_sight_snd_vol = 0.0;
            self.stealth.threat_sight_snd_threat = 0.0;
        }

        self.stealth.threat_sight_snd_vol = clamp( self.stealth.threat_sight_snd_vol, 0.0, 1.0 );

        foreach ( alias, _id_D4479D622A4F5606 in self.stealth.threat_sight_snd_ent )
        {
            _id_6CCDD224B4B73694 = 1.0;

            switch ( index )
            {
                case 0:
                    if ( maxthreat < 0.75 )
                        _id_6CCDD224B4B73694 = cos( 180.0 * maxthreat * 0.666 );
                    else
                        _id_6CCDD224B4B73694 = 0.0;

                    break;
                case 1:
                    if ( maxthreat < 0.75 )
                        _id_6CCDD224B4B73694 = sin( 180.0 * maxthreat * 0.666 );
                    else if ( maxthreat < 1.0 )
                        _id_6CCDD224B4B73694 = sin( 180.0 * ( 1 - maxthreat ) * 2.0 );
                    else
                        _id_6CCDD224B4B73694 = 0.0;

                    break;
                case 2:
                    if ( maxthreat < 0.75 )
                        _id_6CCDD224B4B73694 = 0.0;
                    else
                        _id_6CCDD224B4B73694 = cos( 180.0 * ( 1 - maxthreat ) * 2.0 );

                    break;
            }

            vol = clamp( self.stealth.threat_sight_snd_vol * _id_6CCDD224B4B73694, 0.0, 1.0 );

            if ( vol > 0 )
            {
                _id_CFAEEEA72851152D = 1;

                if ( _id_D4479D622A4F5606.isplaying == 0 )
                {
                    _id_D4479D622A4F5606 _meth_F4604329F388A96F( 0, 0.0 );
                    mapname = getdvar( "dvar_687FB8F9B7A23245" );

                    if ( mapname != "marina" )
                        _id_D4479D622A4F5606 scripts\engine\utility::delaycall( 0.05, ::playloopsound, alias );

                    _id_D4479D622A4F5606.isplaying = 1;
                    self playrumblelooponentity( rumble );
                }

                _id_D4479D622A4F5606 _meth_F4604329F388A96F( vol, 0.05 );
                _id_D4479D622A4F5606 scripts\engine\utility::delaycall( 0.0, ::_meth_F4604329F388A96F, vol, 0.05 );
            }
            else if ( _id_D4479D622A4F5606.isplaying == 1 )
            {
                _id_D4479D622A4F5606 _meth_F4604329F388A96F( 0, 0.05 );
                _id_D4479D622A4F5606 scripts\engine\utility::delaycall( 0.05, ::stoploopsound );
                _id_D4479D622A4F5606.isplaying = 0;
                self stoprumble( rumble );
            }

            index++;
        }

        if ( !_id_CFAEEEA72851152D )
        {
            foreach ( alias, _id_D4479D622A4F5606 in self.stealth.threat_sight_snd_ent )
            {
                _id_D4479D622A4F5606 _meth_F4604329F388A96F( 0, 0.05 );
                _id_D4479D622A4F5606 stoploopsound();
                _id_D4479D622A4F5606 scripts\engine\utility::delaycall( 0.05, ::delete );
            }

            self.stealth.threat_sight_snd_ent = undefined;
            self.stealth.threat_sight_snd_vol = undefined;
            self.stealth.threat_sight_snd_threat = undefined;
        }

        wait 0.05;
    }
}

_id_9B25540DA1B89219()
{
    if ( isdefined( self.stealth.threat_sight_snd_ent ) )
    {
        fade_time = self.stealth.threat_sight_snd_threat / 0.125;

        foreach ( alias, _id_D4479D622A4F5606 in self.stealth.threat_sight_snd_ent )
        {
            _id_D4479D622A4F5606 _meth_F4604329F388A96F( 0, fade_time );
            _id_D4479D622A4F5606 scripts\engine\utility::delaycall( fade_time, ::stoploopsound );
            _id_D4479D622A4F5606 scripts\engine\utility::delaycall( fade_time + 0.05, ::delete );
        }

        self stoprumble( "damage_light" );
        self.stealth.threat_sight_snd_ent = undefined;
        self.stealth.threat_sight_snd_vol = undefined;
        self.stealth.threat_sight_snd_threat = undefined;
    }
}
