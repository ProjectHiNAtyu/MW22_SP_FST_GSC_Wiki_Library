// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

#using_animtree("player");

init_player_rig( _id_6AAF40D85156EC33, _id_2AE369CA3C8D94BA, _id_5E666ED18B1E0D1F )
{
    if ( isdefined( _id_6AAF40D85156EC33 ) )
        precachemodel( _id_6AAF40D85156EC33 );

    if ( isdefined( _id_2AE369CA3C8D94BA ) )
        precachemodel( _id_2AE369CA3C8D94BA );

    if ( isdefined( _id_6AAF40D85156EC33 ) )
    {
        level.scr_animtree["player_rig"] = #animtree;
        level.scr_model["player_rig"] = _id_6AAF40D85156EC33;
    }

    if ( isdefined( _id_2AE369CA3C8D94BA ) )
    {
        level.scr_animtree["player_legs"] = #animtree;
        level.scr_model["player_legs"] = _id_2AE369CA3C8D94BA;
    }

    if ( isdefined( _id_5E666ED18B1E0D1F ) )
        init_player_body( _id_5E666ED18B1E0D1F );
}

init_player_rig_no_precache( _id_6AAF40D85156EC33, _id_2AE369CA3C8D94BA, _id_5E666ED18B1E0D1F )
{
    if ( isdefined( _id_6AAF40D85156EC33 ) )
    {
        level.scr_animtree["player_rig"] = #animtree;
        level.scr_model["player_rig"] = _id_6AAF40D85156EC33;
    }

    if ( isdefined( _id_2AE369CA3C8D94BA ) )
    {
        level.scr_animtree["player_legs"] = #animtree;
        level.scr_model["player_legs"] = _id_2AE369CA3C8D94BA;
    }

    if ( isdefined( _id_5E666ED18B1E0D1F ) )
        init_player_body( _id_5E666ED18B1E0D1F );
}

#using_animtree("generic_human");

init_player_body( _id_5E666ED18B1E0D1F )
{
    level.scr_model["player_body"] = _id_5E666ED18B1E0D1F;
    level.scr_animtree["player_body"] = #animtree;
}

get_player_rig( _id_3E3E6FC934C518CB, _id_A871C06AF7CB87C6 )
{
    if ( !isdefined( level.player_rig ) )
    {
        level.player_rig = scripts\engine\sp\utility::spawn_anim_model( "player_rig" );
        level.player_rig _meth_8BAA620B49E2BEBA();
        _id_3E3E6FC934C518CB = 1;

        if ( scripts\engine\utility::_id_53C4C53197386572( _id_A871C06AF7CB87C6, 0 ) )
            level.player_rig hide();
    }

    if ( istrue( _id_3E3E6FC934C518CB ) )
    {
        level.player_rig.origin = level.player.origin;
        level.player_rig.angles = level.player.angles;
    }

    return level.player_rig;
}

get_player_legs()
{
    if ( !isdefined( level.player_legs ) )
    {
        level.player_legs = scripts\engine\sp\utility::spawn_anim_model( "player_legs" );
        level.player_legs.origin = level.player.origin;
        level.player_legs.angles = level.player.angles;
    }

    return level.player_legs;
}

get_player_body()
{
    if ( !isdefined( level.player_body ) )
    {
        level.player_body = scripts\engine\sp\utility::spawn_anim_model( "player_body" );
        level.player_body.origin = level.player.origin;
        level.player_body.angles = level.player.angles;
    }

    return level.player_body;
}

link_player_to_arms( r, _id_AC0E5E4AC96AAEA7, _id_AC0E454AC96A77AC, _id_AC0E564AC96A9D0F )
{
    if ( !isdefined( r ) )
        r = 30;

    if ( !isdefined( _id_AC0E5E4AC96AAEA7 ) )
        _id_AC0E5E4AC96AAEA7 = 30;

    if ( !isdefined( _id_AC0E454AC96A77AC ) )
        _id_AC0E454AC96A77AC = 30;

    if ( !isdefined( _id_AC0E564AC96A9D0F ) )
        _id_AC0E564AC96A9D0F = 30;

    player_rig = get_player_rig();
    player_rig show();
    level.player playerlinktoabsolute( player_rig, "tag_player" );
    level.player playerlinktodelta( player_rig, "tag_player", 1, r, _id_AC0E5E4AC96AAEA7, _id_AC0E454AC96A77AC, _id_AC0E564AC96A9D0F, 1 );
}

blend_player_to_arms( time )
{
    if ( !isdefined( time ) )
        time = 0.7;

    player_rig = get_player_rig();
    player_rig show();
    level.player playerlinktoblend( player_rig, "tag_player", time );
}

set_player_rig_allows( allows )
{
    if ( !isdefined( allows ) )
    {
        if ( isdefined( level._id_102B18B5F7ED65ED ) )
            allows = level._id_102B18B5F7ED65ED;
        else
        {
            allows = [ "weapon", "offhand_weapons", "melee", "sprint", "allow_jump", "mantle" ];

            if ( isdefined( level._id_5ABD8D1296B08F4B ) )
                allows = scripts\engine\utility::array_add( allows, "crafting" );
        }
    }

    level.player_rig.allows = allows;
}

_id_73341653F76B4E43( allows )
{
    level.player _id_3B64EB40368C1450::_id_C9D0B43701BDBA00( "player_rig" );
    level.player _id_3B64EB40368C1450::_id_59C053B89257BC95( "player_rig", level.player_rig.allows, 0 );
}

_id_6FEDA95D063A745E( anime, _id_B85605EF08D6E4C2, rightarc, leftarc, toparc, bottomarc, _id_562FF78798CBFCC8, _id_984BA707A4AE718E, _id_26967D556F885965 )
{
    return link_player_to_rig( anime, undefined, 1, 0.5, _id_B85605EF08D6E4C2, rightarc, leftarc, toparc, bottomarc, _id_562FF78798CBFCC8, _id_984BA707A4AE718E, _id_26967D556F885965, 1 );
}

link_player_to_rig( anime, stance, _id_E773BEAD7741B3B3, _id_D180B535A33B044D, _id_B85605EF08D6E4C2, rightarc, leftarc, toparc, bottomarc, _id_562FF78798CBFCC8, _id_984BA707A4AE718E, _id_26967D556F885965, _id_8EBCF1AAEB66ADF6, _id_1C5D1595DAB3EF39, _id_EC165A067AF34F8F, _id_8831FC7320076829, _id_E123FEE5AE019570 )
{
    rig = get_player_rig( 1 );
    rig endon( "unlink_player" );
    playerstartpos = level.player.origin;

    if ( isdefined( _id_984BA707A4AE718E ) )
        rig [[ _id_984BA707A4AE718E ]]();

    if ( !isdefined( rig.allows ) )
    {
        if ( istrue( _id_EC165A067AF34F8F ) )
            set_player_rig_allows( [ "offhand_weapons", "melee", "sprint", "allow_jump", "mantle" ] );
        else
            set_player_rig_allows();
    }

    rig hide();

    if ( !istrue( _id_26967D556F885965 ) )
        thread scripts\sp\utility::delete_live_grenades();

    level.player setcinematicmotionoverride( "disabled" );

    if ( isdefined( anime ) && !istrue( _id_1C5D1595DAB3EF39 ) )
        thread scripts\common\anim::anim_first_frame_solo( rig, anime );

    if ( isdefined( anime ) && ( istrue( _id_8EBCF1AAEB66ADF6 ) || istrue( _id_1C5D1595DAB3EF39 ) ) )
    {
        scripts\common\anim::_id_0DBA8EC1939D3F1A( anime, rig.animname, _id_EC165A067AF34F8F, _id_8831FC7320076829, _id_E123FEE5AE019570 );
        _id_D180B535A33B044D = level._id_64FEE87637DE3B30["blendTime"];

        if ( istrue( level._id_64FEE87637DE3B30["weaponDropQuick"] ) )
            level.player enablequickweaponswitch( 1 );
    }
    else
        level.player enablequickweaponswitch( 1 );

    rig.ogstance = level.player getstance();

    if ( !isdefined( stance ) )
        stance = "stand";

    if ( isdefined( level._id_64FEE87637DE3B30 ) && isdefined( level._id_64FEE87637DE3B30["stances"] ) )
    {
        if ( level._id_64FEE87637DE3B30["stances"][0] != "none" )
            stance = level._id_64FEE87637DE3B30["stances"][0];

        if ( level._id_64FEE87637DE3B30["stances"][1] != "none" )
            rig._id_5296297044DB37D9 = level._id_64FEE87637DE3B30["stances"][1];
    }

    rig.stance = stance;

    switch ( stance )
    {
        case "stand":
            rig.allows = scripts\engine\utility::array_combine_unique( rig.allows, [ "crouch", "prone" ] );
            break;
        case "crouch":
            rig.allows = scripts\engine\utility::array_combine_unique( rig.allows, [ "stand", "prone" ] );
            break;
        case "prone":
            rig.allows = scripts\engine\utility::array_combine_unique( rig.allows, [ "crouch", "stand" ] );
            break;
    }

    level.player setstance( stance, 1 );
    level.player _id_73341653F76B4E43();

    if ( istrue( _id_EC165A067AF34F8F ) )
    {
        level.player thread scripts\engine\sp\utility::player_gesture_force( "proto_vm_gesture_gun_drop" );
        _id_19F3850FCEDE775C = level.player getgestureanimlength( "proto_vm_gesture_gun_drop" );
        level.player scripts\engine\utility::delaythread( _id_19F3850FCEDE775C - 0.05, scripts\engine\sp\utility::player_gesture_force, "proto_vm_gesture_gun_loop" );
    }

    if ( !isdefined( _id_E773BEAD7741B3B3 ) )
        _id_E773BEAD7741B3B3 = 1;

    if ( !isdefined( _id_D180B535A33B044D ) )
        _id_D180B535A33B044D = 0.2;

    if ( _id_E773BEAD7741B3B3 )
    {
        level.player playerlinktoblend( rig, "tag_player", _id_D180B535A33B044D );
        wait( _id_D180B535A33B044D );
        waitframe();
    }

    if ( istrue( _id_B85605EF08D6E4C2 ) )
        level.player playerlinktoabsolute( rig, "tag_player" );
    else
    {
        if ( !isdefined( _id_562FF78798CBFCC8 ) )
            _id_562FF78798CBFCC8 = 0;

        if ( !isdefined( rightarc ) )
            rightarc = 45;

        if ( !isdefined( leftarc ) )
            leftarc = 45;

        if ( !isdefined( toparc ) )
            toparc = 15;

        if ( !isdefined( bottomarc ) )
            bottomarc = 15;

        if ( _id_D180B535A33B044D > 0 || istrue( _id_1C5D1595DAB3EF39 ) )
        {
            level.player playerlinktodelta( rig, "tag_player", 1, 170, 170, 170, 170, _id_562FF78798CBFCC8 );
            level.player lerpviewangleclamp( _id_D180B535A33B044D, _id_D180B535A33B044D * 0.5, _id_D180B535A33B044D * 0.25, 0, 0, 0, 0, 1 );

            if ( rightarc || leftarc || toparc || bottomarc )
                level.player scripts\engine\utility::delaycall( _id_D180B535A33B044D, ::lerpviewangleclamp, 1, 0.5, 0.25, rightarc, leftarc, toparc, bottomarc, 1 );
        }
        else
        {
            level.player playerlinktoabsolute( rig, "tag_player" );
            level.player scripts\engine\utility::delaycall( 0.05, ::playerlinktodelta, rig, "tag_player", 1, rightarc, leftarc, toparc, bottomarc, _id_562FF78798CBFCC8 );
        }
    }

    if ( istrue( _id_1C5D1595DAB3EF39 ) )
    {
        _id_0C9DA1B495D3ED8F = 0;

        if ( istrue( _id_E123FEE5AE019570 ) || istrue( _id_EC165A067AF34F8F ) || istrue( _id_8831FC7320076829 ) )
            _id_0C9DA1B495D3ED8F = level._id_64FEE87637DE3B30["weaponDropTime"];

        if ( rig.ogstance != stance )
        {
            _id_40A0D79A69CF53B0 = 0;

            switch ( rig.ogstance )
            {
                case "prone":
                    switch ( stance )
                    {
                        case "crouch":
                            _id_40A0D79A69CF53B0 = 0.5;
                            break;
                        case "stand":
                            _id_40A0D79A69CF53B0 = 0.75;
                            break;
                    }

                    break;
                case "crouch":
                    if ( stance == "stand" )
                        _id_40A0D79A69CF53B0 = 0.2;

                    break;
            }

            _id_0C9DA1B495D3ED8F = max( _id_0C9DA1B495D3ED8F, _id_40A0D79A69CF53B0 );
        }

        rig scripts\engine\utility::delaycall( _id_0C9DA1B495D3ED8F, ::show );
    }
    else
        rig show();

    scripts\sp\utility::nvidiaansel_scriptdisable( 1 );
    level.player notify( "linked_to_rig" );
    return rig;
}

unlink_player_from_rig( _id_1B2BF4BF5E71B6A4, _id_5296297044DB37D9, _id_CC25A02716E677A4, _id_DFB81D6B53106F39, _id_4309472EE3ACCA19, cinematicmotionoverride )
{
    rig = level.player_rig;
    rig notify( "unlink_player" );

    if ( !scripts\engine\utility::is_equal( level.player getlinkedparent(), rig ) )
        return;

    level.player _id_3B64EB40368C1450::_id_C9D0B43701BDBA00( "player_rig" );

    if ( istrue( _id_1B2BF4BF5E71B6A4 ) )
        _id_5296297044DB37D9 = rig.ogstance;

    if ( isdefined( rig._id_5296297044DB37D9 ) )
        _id_5296297044DB37D9 = rig._id_5296297044DB37D9;

    if ( isdefined( _id_5296297044DB37D9 ) )
    {
        if ( istrue( _id_CC25A02716E677A4 ) )
        {
            _id_2DB8031404AAA37E = level.player geteye();
            level.player setstance( _id_5296297044DB37D9, 1, 1, 1 );
            _id_53FD9BCFE97F77D0 = scripts\engine\utility::drop_to_ground( _id_2DB8031404AAA37E, 0, -60, anglestoup( level.player.angles ) );
            level.player setorigin( _id_53FD9BCFE97F77D0, 1 );
        }
        else if ( _id_5296297044DB37D9 != rig.stance )
            level.player setstance( _id_5296297044DB37D9 );
    }

    if ( istrue( _id_4309472EE3ACCA19 ) )
        level.player unlink();
    else
        level.player _meth_AF4B9B0F0E7C6C42( 0.2 );

    level.player enablequickweaponswitch( 0 );
    cinematicmotionoverride = scripts\engine\utility::_id_53C4C53197386572( cinematicmotionoverride, "iw9_playermotion" );
    level.player setcinematicmotionoverride( cinematicmotionoverride );

    if ( !istrue( _id_DFB81D6B53106F39 ) )
        rig delete();

    scripts\sp\utility::nvidiaansel_scriptdisable( 0 );
}

anim_lerp_from_player_pos( anime, _id_69E534485EF2759C, _id_9D02F67D995775A2, _id_D286ADFF9AF13A98, _id_2BBC0F0A7E8DAAAC )
{
    rig = level.player_rig;

    if ( scripts\common\anim::_id_F1E7EE8DDEECE062( anime ) )
        animation = scripts\common\anim::_id_C099F6FD9C19F5A6( anime, self.origin, self.angles, rig.animname );
    else
        animation = level.scr_anim[rig.animname][anime];

    anim_origin = getstartorigin( self.origin, self.angles, animation );
    _id_4F78EC6EAAD4E275 = getstartangles( self.origin, self.angles, animation );
    rotation = level.player.angles - _id_4F78EC6EAAD4E275;
    _id_CA5534A90F13A4D4 = level.player.origin + rotatevector( self.origin - anim_origin, rotation );
    _id_9CFE111EA9DF5B56 = level.player.angles + ( self.angles - _id_4F78EC6EAAD4E275 );
    level._id_46355D1369785029 = scripts\engine\utility::spawn_script_origin( _id_CA5534A90F13A4D4, _id_9CFE111EA9DF5B56 );
    _id_228C1F2F3A2D92F1 = getanimlength( animation );

    if ( !isdefined( _id_D286ADFF9AF13A98 ) )
        _id_D286ADFF9AF13A98 = 0.5;

    if ( !isdefined( _id_2BBC0F0A7E8DAAAC ) )
        _id_2BBC0F0A7E8DAAAC = 0;

    if ( !isdefined( _id_69E534485EF2759C ) )
        _id_69E534485EF2759C = _id_228C1F2F3A2D92F1;

    level._id_46355D1369785029 moveto( self.origin, _id_69E534485EF2759C, _id_69E534485EF2759C * _id_D286ADFF9AF13A98, _id_69E534485EF2759C * ( 1 - _id_D286ADFF9AF13A98 ) );

    if ( !isdefined( _id_9D02F67D995775A2 ) )
        _id_9D02F67D995775A2 = _id_228C1F2F3A2D92F1;

    level._id_46355D1369785029 rotateto( self.angles, _id_9D02F67D995775A2, _id_9D02F67D995775A2 * _id_D286ADFF9AF13A98, _id_9D02F67D995775A2 * ( 1 - _id_D286ADFF9AF13A98 ) );

    if ( _id_2BBC0F0A7E8DAAAC > 0 )
        rig.origin = level.player.origin;

    playerstartpos = level.player.origin;
    rig linkto( level._id_46355D1369785029 );
    wait( _id_2BBC0F0A7E8DAAAC );
    rig notify( anime + "_begin" );
    level._id_46355D1369785029 thread scripts\common\anim::anim_single_solo( rig, anime );
    rig thread scripts\engine\utility::waittillmatch_notify( "single anim", "end", "anim_end" );
    rig scripts\engine\utility::waittill_any( "anim_end", "unlink_player" );
    level._id_46355D1369785029 delete();
}

player_rig_allow_weapon( rig )
{
    player_rig_allow_internal( rig, "weapon" );
}

player_rig_allow_internal( rig, _id_F36A1AE440B2A250 )
{
    rig.allows = scripts\engine\utility::array_remove( rig.allows, _id_F36A1AE440B2A250 );
    level.player thread _id_3B64EB40368C1450::set( "player_rig", _id_F36A1AE440B2A250, 1 );
}

_id_98FABC06359D4D0C( anime, stance, _id_435A21FD34CF3104, _id_E2140D070BB088BD, linkedents, _id_EC165A067AF34F8F, _id_8831FC7320076829, _id_E123FEE5AE019570, _id_26967D556F885965 )
{
    if ( !isdefined( level.player_rig ) )
        get_player_rig();

    if ( !isdefined( stance ) )
        stance = "stand";

    _id_B85605EF08D6E4C2 = 1;

    if ( !isdefined( _id_435A21FD34CF3104 ) )
        _id_435A21FD34CF3104 = [ undefined, undefined, undefined, undefined ];
    else
        _id_B85605EF08D6E4C2 = 0;

    if ( !isdefined( _id_E2140D070BB088BD ) )
        _id_E2140D070BB088BD = [];

    if ( !isarray( _id_E2140D070BB088BD ) )
        _id_E2140D070BB088BD = [ _id_E2140D070BB088BD ];

    if ( !isdefined( linkedents ) )
        linkedents = [];

    if ( !isarray( linkedents ) )
        linkedents = [ linkedents ];

    _id_EC165A067AF34F8F = scripts\engine\utility::ter_op( isdefined( _id_EC165A067AF34F8F ), _id_EC165A067AF34F8F, 1 );
    _id_8831FC7320076829 = scripts\engine\utility::ter_op( isdefined( _id_8831FC7320076829 ), _id_8831FC7320076829, 0 );
    _id_E123FEE5AE019570 = scripts\engine\utility::ter_op( isdefined( _id_E123FEE5AE019570 ), _id_E123FEE5AE019570, 0 );
    _id_4F51EF0BD97A4707 = anime;

    if ( scripts\common\anim::_id_F1E7EE8DDEECE062( anime ) )
    {
        animation = scripts\common\anim::_id_C099F6FD9C19F5A6( anime, self.origin, self.angles, "player_rig" );
        _id_4F51EF0BD97A4707 = scripts\common\anim::_id_56BD620E57A834AF( anime, "player_rig", animation );
    }

    scripts\common\anim::anim_first_frame_solo( level.player_rig, _id_4F51EF0BD97A4707 );
    link_player_to_rig( _id_4F51EF0BD97A4707, stance, 0, 0, _id_B85605EF08D6E4C2, _id_435A21FD34CF3104[0], _id_435A21FD34CF3104[1], _id_435A21FD34CF3104[2], _id_435A21FD34CF3104[3], 1, undefined, _id_26967D556F885965, undefined, 1, _id_EC165A067AF34F8F, _id_8831FC7320076829, _id_E123FEE5AE019570 );
    thread anim_lerp_from_player_pos( _id_4F51EF0BD97A4707, level._id_64FEE87637DE3B30["blendTime"], level._id_64FEE87637DE3B30["blendTime"], 0.8, level._id_64FEE87637DE3B30["weaponDropTime"] );

    if ( isdefined( _id_E2140D070BB088BD ) )
    {
        foreach ( model in _id_E2140D070BB088BD )
        {
            if ( level.player_rig == model )
                _id_E2140D070BB088BD = scripts\engine\utility::array_remove( _id_E2140D070BB088BD, model );
        }
    }

    if ( isdefined( linkedents ) )
    {
        foreach ( model in linkedents )
        {
            if ( level.player_rig == model )
            {
                linkedents = scripts\engine\utility::array_remove( linkedents, model );
                continue;
            }

            model linkto( level._id_46355D1369785029 );
        }
    }

    scripts\common\anim::anim_first_frame( _id_E2140D070BB088BD, anime );
    scripts\engine\utility::delaythread( level._id_64FEE87637DE3B30["weaponDropTime"], scripts\common\anim::anim_single, _id_E2140D070BB088BD, anime );
    level._id_46355D1369785029 scripts\common\anim::anim_first_frame( linkedents, anime );
    level._id_46355D1369785029 scripts\engine\utility::delaythread( level._id_64FEE87637DE3B30["weaponDropTime"], scripts\common\anim::anim_single, linkedents, anime );
    wait( level._id_64FEE87637DE3B30["weaponDropTime"] );
    level.player_rig notify( "link_blend_weapon_dropped" );

    if ( istrue( _id_EC165A067AF34F8F ) && isdefined( level._id_64FEE87637DE3B30["blendOutTime"] ) )
        level.player scripts\engine\utility::delaythread( level._id_64FEE87637DE3B30["blendOutTime"], scripts\engine\sp\utility::player_gesture_force, "proto_vm_gesture_gun_raise" );

    level.player_rig scripts\engine\utility::waittill_any( "anim_end", "unlink_player" );

    if ( istrue( _id_EC165A067AF34F8F ) && !isdefined( level._id_64FEE87637DE3B30["blendOutTime"] ) )
        level.player thread scripts\engine\sp\utility::player_gesture_force( "proto_vm_gesture_gun_raise" );
}
