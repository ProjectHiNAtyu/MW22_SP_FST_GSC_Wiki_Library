// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    if ( !( _func_03CB5DA19764BAA3() == "T10" && isdefined( level._id_6917E6EED10CFC44 ) ) )
        return;

    level thread _id_CF9AE71B5E4F1BB2();
}

_id_CF9AE71B5E4F1BB2()
{
    player = level.player;
    player endon( "death" );
    _id_33BD586B38514163 = undefined;
    _id_9D64F85DB97AFC46 = player;
    _id_F215FF158BDA97DC = spawnstruct();
    _id_F215FF158BDA97DC.ent = _id_9D64F85DB97AFC46;
    _id_F215FF158BDA97DC._id_ED0DA0B9F12F0DA5 = "scripted_widget_anchor_overhead_healthbar";
    player _id_72EF6B9F0CF1F55A::_id_90DE31B2CBEF19F9( "overhead_health_bar", "scripted_widget_anchored_health_bar", _id_F215FF158BDA97DC );
    player _id_72EF6B9F0CF1F55A::_id_D28FA5295A04D555( "overhead_health_bar", "Hidden" );
    _id_A5239ED56421CAB1 = spawnstruct();
    _id_A5239ED56421CAB1._id_DC4E06E204B0A615 = _id_9D64F85DB97AFC46;
    _id_A5239ED56421CAB1.prevhealth = -1;
    player._id_0D9FBE6240C4F8A0 = _id_A5239ED56421CAB1;
    _id_7E564F91187FF3FF = 0;
    _id_902682AFBD62CECC = 750;

    for (;;)
    {
        _id_0C03FCBD268B6512 = undefined;

        if ( _func_5FAAB6FEF1BAF5AE( player._id_9BC5CB3240D03C4C ) && istrue( player._id_9BC5CB3240D03C4C._id_B294AD9BC599B665 ) && !istrue( player._id_9BC5CB3240D03C4C.doinglongdeath ) )
            _id_0C03FCBD268B6512 = player._id_9BC5CB3240D03C4C;

        if ( !scripts\engine\utility::is_equal( _id_33BD586B38514163, _id_0C03FCBD268B6512 ) )
        {
            if ( isdefined( _id_0C03FCBD268B6512 ) )
            {
                player thread _id_E84CF29B39272225( _id_0C03FCBD268B6512 );
                _id_33BD586B38514163 = _id_0C03FCBD268B6512;
                _id_7E564F91187FF3FF = gettime() + _id_902682AFBD62CECC;
            }
            else if ( isdefined( _id_33BD586B38514163 ) )
            {
                if ( vectordot( anglestoforward( player getplayerangles() ), vectornormalize( _id_33BD586B38514163.origin - player getorigin() ) ) > 0.99 )
                    _id_7E564F91187FF3FF = gettime() + _id_902682AFBD62CECC;
                else if ( gettime() > _id_7E564F91187FF3FF )
                {
                    _id_33BD586B38514163 = undefined;
                    player notify( "actor_health_bar_end" );
                    player _id_40869D9E489E5EC4();
                }
            }
        }
        else
            _id_7E564F91187FF3FF = gettime() + _id_902682AFBD62CECC;

        _id_C5452D63F815C7E9 = 0.05;
        wait( _id_C5452D63F815C7E9 );
    }
}

_id_B4E1188DB8263D17( actor )
{
    player = self;

    if ( player._id_0D9FBE6240C4F8A0._id_DC4E06E204B0A615 != actor )
    {
        player _id_72EF6B9F0CF1F55A::_id_7A82D07837107AE6( "overhead_health_bar", actor, "scripted_widget_anchor_overhead_healthbar" );
        player._id_0D9FBE6240C4F8A0._id_DC4E06E204B0A615 = actor;
        player._id_0D9FBE6240C4F8A0.prevhealth = -1;

        if ( isdefined( actor._id_409158B28D97497E ) )
            player setclientomnvar( "scripted_widget_anchored_health_bar_ai_name_index", actor._id_409158B28D97497E );

        player _id_72EF6B9F0CF1F55A::_id_D28FA5295A04D555( "overhead_health_bar", "Active" );
    }
}

_id_40869D9E489E5EC4()
{
    player = self;
    _id_1C75A457E19F3B75 = player;
    player _id_72EF6B9F0CF1F55A::_id_7A82D07837107AE6( "overhead_health_bar", _id_1C75A457E19F3B75, "scripted_widget_anchor_overhead_healthbar" );
    player _id_72EF6B9F0CF1F55A::_id_DDC9D8C3B0EF6B87( "overhead_health_bar", 0, 0, 0.1 );
    player._id_0D9FBE6240C4F8A0._id_DC4E06E204B0A615 = _id_1C75A457E19F3B75;
    player._id_0D9FBE6240C4F8A0.prevhealth = -1;
    player setclientomnvar( "scripted_widget_anchored_health_bar_ai_name_index", 0 );
    player _id_72EF6B9F0CF1F55A::_id_D28FA5295A04D555( "overhead_health_bar", "Hidden" );
}

_id_E84CF29B39272225( actor )
{
    player = self;
    player endon( "death" );
    player notify( "actor_health_bar_end" );
    player endon( "actor_health_bar_end" );
    player notify( "actor_health_bar_abort_delayed_hide" );
    player _id_B4E1188DB8263D17( actor );

    for (;;)
    {
        prevhealth = player._id_0D9FBE6240C4F8A0.prevhealth;

        if ( actor.health != prevhealth )
        {
            _id_6352044291CB2B12 = actor.health / actor.maxhealth;
            _id_8A6EDE63E85CF669 = scripts\engine\utility::ter_op( prevhealth < 0, _id_6352044291CB2B12, prevhealth / actor.maxhealth );
            player _id_72EF6B9F0CF1F55A::_id_DDC9D8C3B0EF6B87( "overhead_health_bar", _id_8A6EDE63E85CF669, _id_6352044291CB2B12, 0.1 );
            player._id_0D9FBE6240C4F8A0.prevhealth = actor.health;
        }

        msg = actor scripts\engine\utility::waittill_any_return_3( "damage", "death", "long_death" );

        if ( msg == "death" || msg == "long_death" )
        {
            player _id_40869D9E489E5EC4();
            break;
        }

        waittillframeend;
    }
}
