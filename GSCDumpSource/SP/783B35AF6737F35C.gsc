// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

precache( offhand )
{
    scripts\sp\equipment\offhands::registeroffhandfirefunc( offhand, ::smokefiremain );
}

smokefiremain( grenade, weapon )
{
    _id_0328D4DC9F970B40 = self;
    _id_0328D4DC9F970B40 thread _id_0F4E8D02D2F70888::evaluateattackevent( "smoke" );
    grenade waittill( "explode", _id_F3E5EC9ECAAF8E1B );
    earthquake( 0.25, 0.35, _id_F3E5EC9ECAAF8E1B, 1000 );
    playrumbleonposition( "grenade_rumble", _id_F3E5EC9ECAAF8E1B );
    _id_A830AA21C1B60A3C = distancesquared( level.player.origin, _id_F3E5EC9ECAAF8E1B );

    if ( _id_A830AA21C1B60A3C <= 22500 )
    {
        _id_5985D426AA39D205 = ( 0, 0, 18 );

        if ( !scripts\engine\trace::ray_trace_passed( level.player.origin + _id_5985D426AA39D205, _id_F3E5EC9ECAAF8E1B + _id_5985D426AA39D205, level.player ) )
            return;

        level.player forceplaygestureviewmodel( "iw9_ges_gas_cough_long", undefined, 0.5, 0, 1, 0 );
    }

    enemies = getaiarray( "axis" );

    foreach ( enemy in enemies )
    {
        distancesquared = distancesquared( enemy.origin, _id_F3E5EC9ECAAF8E1B );
        _id_0690B87CF6507D86 = isdefined( enemy.stealth );
        _id_046ABBA9D70107BE = isdefined( enemy.fnisinstealthcombat ) && enemy [[ enemy.fnisinstealthcombat ]]();

        if ( _id_0690B87CF6507D86 && !_id_046ABBA9D70107BE && distancesquared <= 1000000 )
        {
            event = spawnstruct();
            event.typeorig = "explosion";
            event.type = "cover_blown";
            event.entity = level.player;
            event.origin = _id_F3E5EC9ECAAF8E1B;
            event.investigate_pos = _id_F3E5EC9ECAAF8E1B;
            enemy [[ enemy.fnsetstealthstate ]]( "hunt", event );
        }

        if ( distancesquared <= 57600 )
        {
            enemy _id_4ADE3AE5C138C8B3::saygenericdialogue( "cough_fit" );

            if ( !isdefined( enemy.stealth ) )
                enemy aieventlistenerevent( "explosion", self, _id_F3E5EC9ECAAF8E1B );
        }
    }
}
