// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

precache( offhand )
{
    level.offhands._id_85514A13C82068FD = spawnstruct();
    level.offhands._id_85514A13C82068FD._id_83FC771306EDED0F = [];
    scripts\sp\equipment\offhands::registeroffhandfirefunc( offhand, ::_id_6D77CB0B51CBBB04 );
}

_id_6D77CB0B51CBBB04( grenade, weapon )
{
    if ( !isdefined( grenade ) )
        return;

    self notify( "player_gasTrapPlaced" );
    thread _id_D66E2C658314E5AC( grenade, self, self.team, weapon );
}

_id_D66E2C658314E5AC( grenade, _id_EC0C4E7C490C12D5, team, _id_750C0EDEC8558BF1 )
{
    grenade endon( "entitydeleted" );
    grenade endon( "death" );
    grenade setentityowner( _id_EC0C4E7C490C12D5 );
    grenade setotherent( _id_EC0C4E7C490C12D5 );
    grenade makeunusable();
    grenade.targetname = "offhand_car_grenade";
    _id_CE3E248B427582F1 = grenade.model;
    grenade waittill( "missile_stuck", stuckto, _id_75AC1FBCE3945650, surfacetype, velocity, position, _id_3E293ABD063AA9F5 );
    thread scripts\sp\equipment\offhands::_id_6E5CE23490C6FEA6( grenade, _id_750C0EDEC8558BF1, &"EQUIPMENT/IMPROVISED_MINE_PICKUP" );
    childthread _id_C79A9033E727667F( grenade, _id_EC0C4E7C490C12D5, team );
    childthread _id_01E004FB8A230E0B( grenade );
    level.offhands._id_85514A13C82068FD._id_83FC771306EDED0F = scripts\engine\utility::array_add( level.offhands._id_85514A13C82068FD._id_83FC771306EDED0F, grenade );
}

_id_601BFA752385FED2( grenade, _id_EC0C4E7C490C12D5 )
{
    _id_5A532B3D41B19C7A = getaiarrayinradius( grenade.origin, 200, "axis" );

    foreach ( _id_A09E6D340590460A in _id_5A532B3D41B19C7A )
    {
        if ( !isdefined( _id_A09E6D340590460A.stealth ) )
            continue;

        _id_A09E6D340590460A aieventlistenerevent( "investigate", grenade, grenade.origin );
    }
}

_id_05F0F344F30A1F4B( grenade, _id_EC0C4E7C490C12D5, _id_FF882F75755F7367 )
{
    _id_EC0C4E7C490C12D5 endon( "death" );

    for (;;)
    {
        interact = spawnstruct();
        interact.origin = grenade.origin + ( 0, 0, 5 );
        interact scripts\sp\player\cursor_hint::create_cursor_hint( undefined, ( 0, 0, 0 ), &"EQUIPMENT/IMPROVISED_MINE_PICKUP", 55, 100, 70, 0 );
        thread _id_922F5F6AE49A1314( grenade, interact );
        event = scripts\engine\utility::_id_7B9E0E7CA4B3B940( grenade, "entitydeleted", interact, "trigger" );

        if ( event == "trigger" )
        {
            if ( isdefined( level.offhands._id_B57472ECAE671752["gas_trap"] ) )
                _id_B971E09CE070BD58 = [[ level.offhands._id_B57472ECAE671752["gas_trap"] ]]( "gas_trap" );
            else
                _id_B971E09CE070BD58 = level.player getweaponammoclip( _id_FF882F75755F7367 );

            if ( _id_B971E09CE070BD58 < 4 )
            {
                level.player thread scripts\engine\sp\utility::play_sound_on_entity( "weap_pickup" );
                level.player notify( "player_gasTrapPickedUp" );
                level.player scripts\engine\sp\utility::give_offhand( _id_FF882F75755F7367.basename, _id_B971E09CE070BD58 + 1 ) _id_D05D967E8630A32A( grenade );
                grenade delete();
                break;
            }
        }
        else
        {
            interact notify( "entitydeleted" );
            break;
        }
    }
}

_id_922F5F6AE49A1314( grenade, interact )
{
    grenade endon( "entitydeleted" );
    interact endon( "trigger" );

    if ( isdefined( level.offhands._id_B57472ECAE671752["gas_trap"] ) )
        _id_B971E09CE070BD58 = [[ level.offhands._id_B57472ECAE671752["gas_trap"] ]]( "gas_trap" );
    else
        _id_B971E09CE070BD58 = level.player getweaponammoclip( "gas_trap" );

    _id_D5F6F287AC22711A = _id_B971E09CE070BD58;

    if ( _id_B971E09CE070BD58 >= 4 )
        interact.cursor_hint_ent sethintstring( &"EQUIPMENT/FULL" );
    else
        interact.cursor_hint_ent sethintstring( &"EQUIPMENT/IMPROVISED_MINE_PICKUP" );

    for (;;)
    {
        if ( isdefined( level.offhands._id_B57472ECAE671752["gas_trap"] ) )
            _id_B971E09CE070BD58 = [[ level.offhands._id_B57472ECAE671752["gas_trap"] ]]( "gas_trap" );
        else
            _id_B971E09CE070BD58 = level.player getweaponammoclip( "gas_trap" );

        if ( _id_B971E09CE070BD58 != _id_D5F6F287AC22711A )
        {
            if ( _id_B971E09CE070BD58 >= 4 )
                interact.cursor_hint_ent sethintstring( &"EQUIPMENT/FULL" );
            else
                interact.cursor_hint_ent sethintstring( &"EQUIPMENT/IMPROVISED_MINE_PICKUP" );
        }

        _id_D5F6F287AC22711A = _id_B971E09CE070BD58;
        waitframe();
    }
}

_id_C79A9033E727667F( grenade, _id_EC0C4E7C490C12D5, team )
{
    grenade endon( "entitydeleted" );
    grenade.trigger = spawn( "trigger_radius", grenade.origin, 15, 55, 72 );
    wait 2.0;
    _id_02087E4030AA793B = undefined;

    for (;;)
    {
        grenade.trigger waittill( "trigger", _id_02087E4030AA793B );

        if ( !scripts\engine\utility::is_equal( _id_02087E4030AA793B.team, team ) )
            break;

        if ( !isdefined( _id_02087E4030AA793B.velocity ) )
            continue;

        if ( !length( _id_02087E4030AA793B.velocity ) )
            continue;
    }

    grenade.trigger delete();
    thread _id_D27019E6B9FD97BE( grenade, _id_EC0C4E7C490C12D5 );
}

_id_01E004FB8A230E0B( grenade )
{
    grenade endon( "entitydeleted" );
    scriptmodel = spawn( "script_model", grenade.origin );
    scriptmodel.angles = grenade.angles;
    scriptmodel setmodel( grenade.model );
    scriptmodel setcandamage( 1 );
    scriptmodel.maxhealth = 100000;
    scriptmodel.health = scriptmodel.maxhealth;
    thread _id_B0930D0F316C2785( grenade, scriptmodel );

    for (;;)
    {
        scriptmodel waittill( "damage", _id_DDD80F5D1DA23C60, attacker, _id_DDD80F5D1DA23C60, _id_DDD80F5D1DA23C60, meansofdeath );

        if ( !isplayer( attacker ) )
            continue;

        if ( meansofdeath == "MOD_MELEE" )
            continue;

        thread _id_D27019E6B9FD97BE( grenade, attacker );
        break;
    }
}

_id_B0930D0F316C2785( grenade, scriptmodel )
{
    grenade waittill( "entitydeleted" );
    scriptmodel delete();
}

_id_D27019E6B9FD97BE( grenade, _id_EC0C4E7C490C12D5 )
{
    earthquake( 0.25, 0.35, grenade.origin, 1000 );
    playrumbleonposition( "grenade_rumble", grenade.origin );
    _id_A830AA21C1B60A3C = distancesquared( level.player.origin, grenade.origin );

    if ( _id_A830AA21C1B60A3C <= 22500 )
        thread scripts\sp\equipment\offhands::_id_14DD7FE1D23F9DC3( "iw9_ges_gas_cough_long", grenade.origin, "gas_trap", 150 );

    enemies = getaiarrayinradius( grenade.origin, 350, "axis" );

    foreach ( enemy in enemies )
    {
        enemy notify( "flashbang", grenade.origin, 1, 1, _id_EC0C4E7C490C12D5, "allies", 9 );
        enemy thread _id_955E0E9B64AC2B2F( _id_EC0C4E7C490C12D5 );
    }

    if ( isdefined( grenade.trigger ) )
        grenade.trigger delete();

    _id_D05D967E8630A32A( grenade );
    grenade detonate();
}

_id_D05D967E8630A32A( _id_85514A13C82068FD )
{
    level.offhands._id_85514A13C82068FD._id_83FC771306EDED0F = scripts\engine\utility::array_remove( level.offhands._id_85514A13C82068FD._id_83FC771306EDED0F, _id_85514A13C82068FD );
}

_id_955E0E9B64AC2B2F( _id_EC0C4E7C490C12D5 )
{
    self notify( "stop_gasTrapEffects" );
    self endon( "stop_gasTrapEffects" );
    self endon( "death" );
    _id_4ADE3AE5C138C8B3::saygenericdialogue( "cough_fit" );
    self._id_D7A3873A03947A34 = gettime();

    for (;;)
    {
        waitframe();

        if ( self isinscriptedstate() )
            continue;

        if ( scripts\engine\utility::isflashed() )
        {
            self._id_D7A3873A03947A34 = gettime();
            continue;
        }

        if ( scripts\engine\utility::time_has_passed( self._id_D7A3873A03947A34, 15 ) )
        {
            self notify( "flashbang", self.origin, 1, 1, _id_EC0C4E7C490C12D5, "allies", 3 );
            _id_4ADE3AE5C138C8B3::saygenericdialogue( "cough_fit" );
            self._id_D7A3873A03947A34 = gettime();
        }
    }
}
