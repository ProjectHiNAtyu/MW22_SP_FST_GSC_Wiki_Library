// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    _id_796FB8CF0E48872B = 0;

    if ( !_id_796FB8CF0E48872B )
        return;

    precachestring( &"GAME/DAMAGE_REGEN" );
    setomnvar( "ui_gettocover_text", "game/damage_regen" );
    player = level.player;
    player _id_B75F25F14290E382();
    player _id_3B64EB40368C1450::set( "health_regen_perm_disable", "health_regen", 0 );
    player scripts\engine\sp\utility::add_damage_function( ::_id_A9E9BBDBE973B8AA );
    player thread _id_071E7E6DD5710C3A();
    player thread _id_2F44C38F99DAA9DF();
    player thread _id_5543421C71EAB398();
    scripts\engine\sp\utility::add_global_spawn_function( "axis", ::_id_1083512A5386A5B4 );
}

_id_F53178D2E1CF9DDA( _id_9BA3D8EA18E00AF8 )
{
    player = self;

    if ( !isdefined( player._id_CEA0A064D52AA058 ) )
        return;

    player._id_CEA0A064D52AA058._id_50563B347FC5A71F = scripts\engine\utility::array_add( player._id_CEA0A064D52AA058._id_50563B347FC5A71F, _id_9BA3D8EA18E00AF8 );
    _id_9BA3D8EA18E00AF8 thread _id_603423ED6C716AF8();
}

_id_6B1D63E76538F839( _id_9BA3D8EA18E00AF8 )
{
    player = self;

    if ( !isdefined( player._id_CEA0A064D52AA058 ) )
        return;

    player._id_CEA0A064D52AA058._id_50563B347FC5A71F = scripts\engine\utility::array_remove( player._id_CEA0A064D52AA058._id_50563B347FC5A71F, _id_9BA3D8EA18E00AF8 );
    _id_9BA3D8EA18E00AF8 notify( "combat_ally_unregistered" );
}

_id_B75F25F14290E382()
{
    player = self;
    level.difficultysettings["player_combat_regen_cap"]["easy"] = 0.1;
    level.difficultysettings["player_combat_regen_cap"]["normal"] = 0.1;
    level.difficultysettings["player_combat_regen_cap"]["hardened"] = 0.1;
    level.difficultysettings["player_combat_regen_cap"]["veteran"] = 0.1;
    level.difficultysettings["player_combat_regen_cap"]["realism"] = 0.1;
    level.difficultysettings["player_damage_regen_rate"]["easy"] = 0.1;
    level.difficultysettings["player_damage_regen_rate"]["normal"] = 0.1;
    level.difficultysettings["player_damage_regen_rate"]["hardened"] = 0.1;
    level.difficultysettings["player_damage_regen_rate"]["veteran"] = 0.1;
    level.difficultysettings["player_damage_regen_rate"]["realism"] = 0.1;
    player._id_CEA0A064D52AA058 = spawnstruct();
    player._id_CEA0A064D52AA058._id_D0F761477557D246 = 1.0;
    player._id_CEA0A064D52AA058._id_E66C9A59AC2E6FE3 = 0;
    player._id_CEA0A064D52AA058._id_E6D57359DA86D8CF = "out_of_combat";
    player._id_CEA0A064D52AA058._id_A9282886D5EF3F10 = 0;
    player._id_CEA0A064D52AA058._id_50563B347FC5A71F = [];
    player._id_CEA0A064D52AA058._id_7F08E0EB21A1CF7E = 0;
    player._id_CEA0A064D52AA058._id_697501C9096F3828 = 0;
    player._id_CEA0A064D52AA058._id_A99B0BA25F526026 = 0;
    player._id_CEA0A064D52AA058._id_CED6778AC5E7BA45 = 0;
}

_id_B6B6B325DC4500A8()
{
    player = self;
    _id_95727AA574B3AA06 = player scripts\common\gameskill::get_difficultysetting( "player_combat_regen_cap" );
    return _id_95727AA574B3AA06;
}

_id_BE2EDE24D0898541( enemy )
{
    player = self;
    _id_8C7A934F647872BC = player scripts\common\gameskill::get_difficultysetting( "player_damage_regen_rate" );

    if ( isdefined( enemy ) && enemy scripts\engine\utility::damagelocationisany( "head", "helmet", "neck" ) )
        _id_8C7A934F647872BC = _id_8C7A934F647872BC * 2.0;

    return _id_8C7A934F647872BC;
}

_id_CB8A79085202F1A6()
{
    player = self;
    _id_DF838BE8EFCAABC0 = player._id_1760D855DFE5BBAF;

    foreach ( guy in player._id_CEA0A064D52AA058._id_50563B347FC5A71F )
        _id_DF838BE8EFCAABC0 = _id_DF838BE8EFCAABC0 + guy._id_1760D855DFE5BBAF;

    return _id_DF838BE8EFCAABC0;
}

_id_071E7E6DD5710C3A()
{
    player = self;
    player endon( "death" );

    for (;;)
    {
        _id_53DBEADED0E2FBBF = player scripts\engine\utility::waittill_any_return_7( "weapon_fired", "grenade_fire", "damage", "damaged_badguy", "ally_weapon_fired", "ally_grenade_fire", "ally_damage" );
        player._id_CEA0A064D52AA058._id_A9282886D5EF3F10 = 1;
    }
}

_id_603423ED6C716AF8()
{
    ally = self;
    ally notify( "allyCombatEventsMonitor_singleton" );
    ally endon( "allyCombatEventsMonitor_singleton" );
    ally endon( "combat_ally_unregistered" );
    player = level.player;

    for (;;)
    {
        _id_265B010E35B08021 = ally scripts\engine\utility::waittill_any_return_4( "shooting", "grenade_fire", "damage", "death" );

        switch ( _id_265B010E35B08021 )
        {
            case "shooting":
                player notify( "ally_weapon_fired" );
                break;
            case "grenade_fire":
                player notify( "ally_grenade_fire" );
                break;
            case "damage":
                player notify( "ally_damage" );
                break;
            case "death":
                player _id_6B1D63E76538F839( ally );
                break;
            default:
                break;
        }
    }
}

_id_2F44C38F99DAA9DF()
{
    player = self;
    player endon( "death" );
    _id_D7D725E032FACBE5 = 0;
    player thread _id_D79658FA29663075( _id_D7D725E032FACBE5 );

    for (;;)
    {
        _id_046ABBA9D70107BE = player._id_CEA0A064D52AA058._id_A9282886D5EF3F10 || player _id_CB8A79085202F1A6() > 0;
        player._id_CEA0A064D52AA058._id_A9282886D5EF3F10 = 0;

        if ( _id_046ABBA9D70107BE != _id_D7D725E032FACBE5 )
        {
            player thread _id_D79658FA29663075( _id_046ABBA9D70107BE );
            _id_D7D725E032FACBE5 = _id_046ABBA9D70107BE;
        }

        waitframe();
    }
}

_id_D79658FA29663075( isincombat )
{
    player = self;
    player endon( "death" );
    player notify( "healthRegenControl_singleton" );
    player endon( "healthRegenControl_singleton" );

    if ( isincombat )
    {
        player._id_CEA0A064D52AA058._id_E6D57359DA86D8CF = "in_combat";
        player._id_CEA0A064D52AA058._id_D0F761477557D246 = player _id_B6B6B325DC4500A8();
    }
    else
    {
        player._id_CEA0A064D52AA058._id_E6D57359DA86D8CF = "out_of_combat_pending";
        _id_17CD4256F0F614C5 = 7.0;
        wait( _id_17CD4256F0F614C5 );
        player._id_CEA0A064D52AA058._id_E6D57359DA86D8CF = "out_of_combat";
        player._id_CEA0A064D52AA058._id_D0F761477557D246 = 1.0;
        player._id_CEA0A064D52AA058._id_E66C9A59AC2E6FE3 = 1;
        player thread _id_1C9479E4D7E1C574( 1 );
    }
}

_id_A9E9BBDBE973B8AA( damage, attacker, direction, point, type, _id_7178D1AB6020C7C2, inflictor )
{
    player = self;

    if ( player._id_CEA0A064D52AA058._id_697501C9096F3828 > 0 )
    {
        _id_787585D4E82E1E58 = min( damage, player._id_CEA0A064D52AA058._id_697501C9096F3828 );
        _id_96EA89E3DFB41623 = clamp( player.health + _id_787585D4E82E1E58, 0, player.maxhealth );
        player scripts\sp\player::set_normalhealth( _id_96EA89E3DFB41623 / player.maxhealth );
        player._id_CEA0A064D52AA058._id_697501C9096F3828 = max( 0, player._id_CEA0A064D52AA058._id_697501C9096F3828 - damage );
    }

    if ( player._id_CEA0A064D52AA058._id_E66C9A59AC2E6FE3 )
        return;

    player thread _id_1C9479E4D7E1C574();
}

_id_1C9479E4D7E1C574( _id_EA69E390541CE33E )
{
    player = self;
    player endon( "death" );
    player notify( "regenerateHealthToCap_singleton" );
    player endon( "regenerateHealthToCap_singleton" );

    if ( !istrue( _id_EA69E390541CE33E ) )
    {
        _id_C9D3262A60835C51 = player scripts\sp\player::gethealthregendelay();
        wait( _id_C9D3262A60835C51 );
    }

    while ( player scripts\sp\player::damageflag( 2 ) || player scripts\sp\player::damageflag( 32 ) )
        waitframe();

    _id_5E8799555F72FB99 = int( player.maxhealth * player._id_CEA0A064D52AA058._id_D0F761477557D246 + 0.5 );
    _id_83C87E7E2846EDD5 = player.health;

    while ( player.health < _id_5E8799555F72FB99 )
    {
        _id_024493F7B31ECFBD = player scripts\sp\player::gethealthregenpersecond();
        _id_C2DC95DA0D5F4AEB = _id_024493F7B31ECFBD * 0.05;
        _id_83C87E7E2846EDD5 = clamp( _id_83C87E7E2846EDD5 + _id_C2DC95DA0D5F4AEB, 0, _id_5E8799555F72FB99 );
        player scripts\sp\player::set_normalhealth( _id_83C87E7E2846EDD5 / player.maxhealth );
        waitframe();
    }

    player._id_CEA0A064D52AA058._id_E66C9A59AC2E6FE3 = 0;
}

_id_1083512A5386A5B4()
{
    _id_0B1C5A610965C297 = self;

    if ( isdefined( _id_0B1C5A610965C297.damage_functions ) )
        _id_0B1C5A610965C297 scripts\engine\sp\utility::add_damage_function( ::_id_296DBFD2CBEE9E46 );
}

_id_296DBFD2CBEE9E46( damage, attacker, direction_vec, point, type, modelname, tagname, partname, idflags, objweapon )
{
    if ( isplayer( attacker ) )
    {
        player = attacker;
        prevhealth = player _id_720947E23FCF8936();
        _id_8C7A934F647872BC = player _id_BE2EDE24D0898541( self );
        _id_BC96F547635CCD93 = int( damage * _id_8C7A934F647872BC + 0.5 );
        player _id_CF278622DEC7F3B8( _id_BC96F547635CCD93 );
        _id_EDF34A99C4635317 = player _id_720947E23FCF8936();
        player thread _id_B58D90EAEC62D1A6();
        player notify( "damaged_badguy" );

        if ( _id_EDF34A99C4635317 > prevhealth )
        {
            _id_CF435B1315C922CB = _id_EDF34A99C4635317 - prevhealth;
            player._id_CEA0A064D52AA058._id_7F08E0EB21A1CF7E = player._id_CEA0A064D52AA058._id_7F08E0EB21A1CF7E + _id_CF435B1315C922CB;
            player notify( "new_health_regen" );
        }

        if ( !isalive( self ) || self.delayeddeath )
            player thread _id_448DE6D688129278();
    }
}

_id_448DE6D688129278()
{
    player = self;
    player endon( "death" );
    player notify( "healthManagementEnemyKillCounter" );
    player endon( "healthManagementEnemyKillCounter" );
    _id_A1039C73940C98D3 = 5.0;
    _id_997B9C848800136C = 5;
    _id_B6C7132BBF2FA734 = 1.0;
    _id_9E67D90624F38299 = 20;

    if ( player._id_CEA0A064D52AA058._id_A99B0BA25F526026 > 0 )
    {
        player._id_CEA0A064D52AA058._id_CED6778AC5E7BA45 = 0;
        return;
    }

    player._id_CEA0A064D52AA058._id_CED6778AC5E7BA45++;

    if ( player._id_CEA0A064D52AA058._id_CED6778AC5E7BA45 >= _id_997B9C848800136C )
    {
        player._id_CEA0A064D52AA058._id_CED6778AC5E7BA45 = 0;
        player._id_CEA0A064D52AA058._id_A99B0BA25F526026 = int( player.maxhealth * _id_B6C7132BBF2FA734 );
        player _id_CF278622DEC7F3B8( player._id_CEA0A064D52AA058._id_A99B0BA25F526026 );
        player thread _id_CBF39B63A751A5B6( _id_9E67D90624F38299 );
        return;
    }

    wait( _id_A1039C73940C98D3 );
    player._id_CEA0A064D52AA058._id_CED6778AC5E7BA45 = 0;
}

_id_CBF39B63A751A5B6( waittime )
{
    player = self;
    player endon( "death" );
    player notify( "healthManagementAdrenalineWaitForExpire" );
    player endon( "healthManagementAdrenalineWaitForExpire" );
    wait( waittime );
    player._id_CEA0A064D52AA058._id_697501C9096F3828 = 0;
    player._id_CEA0A064D52AA058._id_A99B0BA25F526026 = 0;
    player._id_CEA0A064D52AA058._id_CED6778AC5E7BA45 = 0;
}

_id_720947E23FCF8936()
{
    player = self;
    return player.health + player._id_CEA0A064D52AA058._id_697501C9096F3828;
}

_id_CF278622DEC7F3B8( _id_76DFA878EC11B3FD )
{
    player = self;
    _id_D422F2A5DEC27492 = player.maxhealth + player._id_CEA0A064D52AA058._id_A99B0BA25F526026;
    _id_EDF34A99C4635317 = clamp( player _id_720947E23FCF8936() + _id_76DFA878EC11B3FD, 0, _id_D422F2A5DEC27492 );
    _id_1FBD766825ED251C = clamp( _id_EDF34A99C4635317 / player.maxhealth, 0, 1.0 );
    player scripts\sp\player::set_normalhealth( _id_1FBD766825ED251C );

    if ( player._id_CEA0A064D52AA058._id_A99B0BA25F526026 > 0 )
        player._id_CEA0A064D52AA058._id_697501C9096F3828 = max( 0, _id_EDF34A99C4635317 - player.health );
}

_id_B58D90EAEC62D1A6()
{
    player = self;
    player endon( "death" );
    player notify( "killDamageEffects_singleton" );
    player endon( "killDamageEffects_singleton" );
    wait 0.2;

    if ( player scripts\sp\player::damageflag( 2 ) || player scripts\sp\player::damageflag( 32 ) )
        return;

    player scripts\sp\player::remove_damage_effects_instantly();
}

_id_5543421C71EAB398()
{
    player = self;
    player endon( "death" );
    _id_82BD7425AB6A7357 = 0.2;

    for (;;)
    {
        if ( player._id_CEA0A064D52AA058._id_7F08E0EB21A1CF7E > 0 )
        {
            player setclientomnvar( "ui_player_health_regen", int( player._id_CEA0A064D52AA058._id_7F08E0EB21A1CF7E ) );
            player._id_CEA0A064D52AA058._id_7F08E0EB21A1CF7E = 0;
            wait( _id_82BD7425AB6A7357 );
            player setclientomnvar( "ui_player_health_regen", 0 );
            continue;
        }

        player waittill( "new_health_regen" );
    }
}
