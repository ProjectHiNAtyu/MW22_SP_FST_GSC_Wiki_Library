// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    scripts\engine\sp\utility::add_global_spawn_function( "axis", ::_id_F0B73EF0DEA0B5E1 );
    precachestring( &"SCRIPT/USE_PICKUP_BODY" );
    precachestring( &"SCRIPT/USE_DROP" );
    setsaveddvar( "dvar_32196FA75434C856", 1 );
    level.player._id_E07CC369487BAEB1 = spawnstruct();
}

_id_3F00ABFA55FC4C75( prompt )
{
    corpse = self;

    if ( !isent( corpse ) )
        return;

    corpse thread _id_D3D719E0C7D41692( prompt );
    corpse thread _id_516573F96DB3AF22();
}

_id_F0B73EF0DEA0B5E1()
{
    ai = self;

    if ( !isai( ai ) )
        return;

    ai thread _id_D2D1AD71177B2797();
}

_id_D2D1AD71177B2797()
{
    entity = self;
    entity endon( "entitydeleted" );
    entnum = entity getentitynumber();
    entity waittill( "become_corpse" );
    corpse = getentbynum( entnum );

    if ( isdefined( corpse ) && !isai( corpse ) )
        corpse scripts\engine\utility::delaythread( 0.5, ::_id_3F00ABFA55FC4C75 );
}

_id_516573F96DB3AF22()
{
    corpse = self;
    _id_C81AC9EFE9EBA25B = corpse.classname == "script_model";
    trigger = corpse.trigger;

    while ( isent( corpse ) && !isai( corpse ) )
    {
        origin = corpse.origin;
        waittime = 1.0;

        if ( corpse isragdoll() )
        {
            if ( !_id_C81AC9EFE9EBA25B && getdvarint( "dvar_32196FA75434C856", 0 ) )
                origin = corpse getcorpsephysicsorigin();

            if ( distancesquared( origin, corpse.origin ) > 0.001 )
            {
                corpse.origin = origin;
                trigger.origin = corpse.origin;
                waittime = 0.05;
            }
        }

        wait( waittime );
    }

    if ( isent( trigger ) )
        trigger delete();
}

_id_D3D719E0C7D41692( prompt )
{
    corpse = self;
    prompt = scripts\engine\utility::_id_53C4C53197386572( prompt, &"SCRIPT/USE_PICKUP_BODY" );
    corpse.trigger = spawn( "trigger_radius", corpse.origin, 0, 20, 10 );
    corpse.prompt = prompt;
    corpse thread _id_D977D4A61CF439F3();
}

_id_D977D4A61CF439F3()
{
    corpse = self;
    trigger = corpse.trigger;
    corpse endon( "entitydeleted" );
    trigger endon( "entitydeleted" );

    for (;;)
    {
        trigger waittill( "trigger", player );

        if ( isdefined( player._id_E07CC369487BAEB1 ) && isdefined( player._id_E07CC369487BAEB1.carrying ) )
            continue;

        _id_D539DD4D949070D9 = player geteye();
        _id_4220B8768B4B5F44 = vectornormalize( corpse.origin - _id_D539DD4D949070D9 );
        _id_898F508242FA99F6 = anglestoforward( player getplayerangles() );

        if ( vectordot( _id_898F508242FA99F6, _id_4220B8768B4B5F44 ) > 0.8 )
            player thread _id_B0084ACA85510872( corpse, 1, corpse.prompt );
    }
}

_id_A4BE819A70AFE86E()
{

}

_id_7D7366CE8CBE9ECF()
{

}

_id_BF41176DE8CABB8B( corpse )
{
    player = self;
    player._id_E07CC369487BAEB1.carrying = "body_carry_object";
    player _id_A4BE819A70AFE86E();
    player _id_4D2990A9EFDD44C4( 1 );
    player._id_E07CC369487BAEB1.model = corpse.model;
    player._id_E07CC369487BAEB1.attachments = [];

    for ( _id_AC0E594AC96AA3A8 = 0; _id_AC0E594AC96AA3A8 < corpse getattachsize(); _id_AC0E594AC96AA3A8++ )
        player._id_E07CC369487BAEB1.attachments[player._id_E07CC369487BAEB1.attachments.size] = [ corpse getattachmodelname( _id_AC0E594AC96AA3A8 ), corpse getattachtagname( _id_AC0E594AC96AA3A8 ) ];

    player setcarryobject( player._id_E07CC369487BAEB1.carrying );
    player thread _id_2C73B28E2F13CE5F();
    corpse delete();
}

_id_4D2990A9EFDD44C4( carrying )
{
    player = self;

    if ( !istrue( carrying ) )
        player _id_3B64EB40368C1450::_id_C9D0B43701BDBA00( "carry" );
    else
    {
        player _id_3B64EB40368C1450::set( "carry", "prone", 0 );
        player _id_3B64EB40368C1450::set( "carry", "slide", 0 );
        player _id_3B64EB40368C1450::set( "carry", "supersprint", 0 );
        player _id_3B64EB40368C1450::set( "carry", "mount_side", 0 );
        player _id_3B64EB40368C1450::set( "carry", "mount_top", 0 );
        player _id_3B64EB40368C1450::set( "carry", "mantle", 0 );
        player _id_3B64EB40368C1450::set( "carry", "equipment_secondary", 0 );
        player _id_3B64EB40368C1450::set( "carry", "supers", 0 );
        player _id_3B64EB40368C1450::set( "carry", "melee", 0 );
        player _id_3B64EB40368C1450::set( "carry", "weapon_switch", 0 );
        player _id_3B64EB40368C1450::set( "carry", "reload", 0 );
        player _id_3B64EB40368C1450::set( "carry", "ads", 1 );
        player _id_3B64EB40368C1450::set( "carry", "move_speed_scale", 0.75 );
        player _id_3B64EB40368C1450::set( "carry", "stealth_social_reveal", 1 );
    }
}

_id_2C73B28E2F13CE5F()
{
    player = self;
    player endon( "death_or_disconnect" );
    player thread _id_F59BC7B31BAD9D1A( 0.5 );
    player notifyonplayercommand( "body_drop", "+usereload" );

    for (;;)
    {
        player waittill( "body_drop" );

        if ( !isdefined( player._id_E07CC369487BAEB1.droporigin ) )
            continue;

        player notify( "body_carry_playerMonitorDrop" );
        player _id_4C0F25120AE1C9A6::_id_8AA54007D532F449( "body_carry" );
        player resetcarryobject();
        player notifyonplayercommandremove( "body_drop", "+usereload" );
        player._id_E07CC369487BAEB1.carrying = undefined;
        player _id_7D7366CE8CBE9ECF();
        player _id_87FED6FB4486D13B();
        player scripts\engine\utility::delaythread( 0.25, ::_id_4D2990A9EFDD44C4, 0 );
        break;
    }
}

_id_F59BC7B31BAD9D1A( _id_04400D6A8D876BD9 )
{
    player = self;
    player notify( "body_carry_playerMonitorDrop" );
    player endon( "body_carry_playerMonitorDrop" );

    if ( isdefined( _id_04400D6A8D876BD9 ) && _id_04400D6A8D876BD9 > 0 )
        wait( _id_04400D6A8D876BD9 );

    for (;;)
    {
        start = player geteye();
        end = start + anglestoforward( player getplayerangles() ) * 64;
        player._id_E07CC369487BAEB1.droporigin = undefined;
        player _id_4C0F25120AE1C9A6::_id_8AA54007D532F449( "body_carry" );

        for ( _id_467003532BDC5C8A = 0; _id_467003532BDC5C8A < 2; _id_467003532BDC5C8A++ )
        {
            trace = scripts\engine\trace::sphere_trace( start, end, 25.0, [ player ], undefined, 1 );
            _id_24A474D9CCB84218 = trace["fraction"];

            if ( _id_24A474D9CCB84218 > 0.25 && _id_24A474D9CCB84218 < 0.95 )
            {
                if ( vectordot( trace["contact_normal"], ( 0, 0, 1 ) ) > 0.8 )
                {
                    player._id_E07CC369487BAEB1.droporigin = trace["position"];
                    player _id_4C0F25120AE1C9A6::_id_BD850D4D3B0D537C( "body_carry", &"SCRIPT/USE_DROP" );
                    break;
                }
            }

            end = start + anglestoforward( player.angles ) * 32 + ( 0, 0, -65 );
        }

        waitframe();
    }
}

_id_B0084ACA85510872( corpse, enabled, prompt )
{
    prompt = scripts\engine\utility::_id_53C4C53197386572( prompt, &"SCRIPT/USE_PICKUP_BODY" );
    player = self;
    player notify( "body_carry_playerPickupWait" );
    player endon( "body_carry_playerPickupWait" );

    if ( enabled )
    {
        player _id_4C0F25120AE1C9A6::_id_BD850D4D3B0D537C( "body_carry", prompt );
        player._id_E07CC369487BAEB1._id_F1E2E2166C5C7BC1 = corpse;
        player _id_3B64EB40368C1450::set( "body_carry_prompt", "usability", 0 );
        player _id_3B64EB40368C1450::set( "body_carry_prompt", "reload", 0 );
        player thread _id_870D72218BF77236( 1 );
        wait 0.1;
    }

    player _id_4C0F25120AE1C9A6::_id_8AA54007D532F449( "body_carry" );
    player._id_E07CC369487BAEB1._id_F1E2E2166C5C7BC1 = undefined;
    player _id_3B64EB40368C1450::_id_C9D0B43701BDBA00( "body_carry_prompt" );
    player thread _id_870D72218BF77236( 0 );
}

_id_870D72218BF77236( enabled )
{
    player = self;
    player notify( "body_carry_playerPickupWaitInput" );
    player endon( "body_carry_playerPickupWaitInput" );

    if ( !enabled )
    {
        player notifyonplayercommandremove( "body_pickup", "+usereload" );
        return;
    }

    player endon( "death_or_disconnect" );
    player notifyonplayercommand( "body_pickup", "+usereload" );

    for (;;)
    {
        player waittill( "body_pickup" );

        if ( !isdefined( player._id_E07CC369487BAEB1._id_F1E2E2166C5C7BC1 ) )
            continue;

        player notifyonplayercommandremove( "body_pickup", "+usereload" );
        player _id_BF41176DE8CABB8B( player._id_E07CC369487BAEB1._id_F1E2E2166C5C7BC1 );
    }
}

#using_animtree("generic_human");

_id_87FED6FB4486D13B()
{
    player = self;
    _id_44A0133272FB77AD = spawn( "script_model", player._id_E07CC369487BAEB1.droporigin );
    _id_44A0133272FB77AD.angles = player.angles;
    _id_44A0133272FB77AD setmodel( player._id_E07CC369487BAEB1.model );
    _id_44A0133272FB77AD useanimtree( #animtree );

    foreach ( attachment in player._id_E07CC369487BAEB1.attachments )
        _id_44A0133272FB77AD attach( attachment[0], attachment[1], 1 );

    _id_44A0133272FB77AD startragdoll();
    _id_44A0133272FB77AD thread _id_D2D1AD71177B2797();
    _id_44A0133272FB77AD notify( "become_corpse" );
}
