// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    level.player thread firemanager();
}

firemanager()
{
    self.offhands = spawnstruct();
    self.offhands.lastusedoffhandweapon = undefined;
    self.offhands.lastusedoffhandtime = 0;

    for (;;)
    {
        has_gl = 0;
        self waittill( "missile_fire", missile, weapon );
        _id_1FF324690AE58BE4 = getweaponattachments( weapon );

        if ( isdefined( _id_1FF324690AE58BE4 ) && _id_1FF324690AE58BE4.size > 0 )
        {
            foreach ( attachment in _id_1FF324690AE58BE4 )
            {
                if ( issubstr( attachment, "gl" ) )
                    has_gl = 1;
            }
        }

        if ( weapon.basename == "iw8_la_mike32_incendiary" )
        {
            missile thread watchforimpact( "explode" );
            continue;
        }

        if ( has_gl )
            missile thread watchforimpact( "missile_stuck" );
    }
}

watchforimpact( msg )
{
    self endon( "entitydeleted" );
    owner = getmissileowner( self );

    if ( msg == "missile_stuck" )
    {
        self waittill( "missile_stuck", velocity, origin, normal, stuckto, _id_B3FCD958F4D7876E, surfacetype );

        if ( distance2d( owner.origin, origin ) > 200 )
        {
            scripts\sp\equipment\molotov::molotovexplode( origin, normal, velocity, stuckto, owner );
            return;
        }

        self delete();
        return;
    }
    else
    {
        self waittill( msg, velocity, origin, normal, entity );
        scripts\sp\equipment\molotov::molotovexplode( origin, normal, velocity, entity, owner );
    }
}
