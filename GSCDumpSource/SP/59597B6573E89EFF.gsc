// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    precachemodel( "military_bullet_armor_pierce" );
    level._effect["bullet_cam_flesh_impact"] = loadfx( "vfx/iw9/core/weapons/impacts/vfx_imp_flesh_fatal_med.vfx" );
}

_id_E37AE8D13712B645()
{
    self _meth_909FA2C630F3E996( ::_id_343D6AF5655928A6 );
}

_id_343D6AF5655928A6( damage, attacker, point, hitloc, mod, objweapon )
{
    victim = self;
    _id_A626421DDD45A801 = isplayer( attacker ) && damage >= victim.health && ( mod == "MOD_PISTOL_BULLET" || mod == "MOD_RIFLE_BULLET" );

    if ( !_id_A626421DDD45A801 )
        return damage;

    _id_9DF735F45738CA81 = distancesquared( attacker getorigin(), victim getorigin() ) < 640000.0;

    if ( _id_9DF735F45738CA81 )
        return damage;

    _id_D70A5AD30766108E = spawnstruct();
    _id_D70A5AD30766108E.player = attacker;
    _id_D70A5AD30766108E.victim = victim;
    _id_D70A5AD30766108E.damage = damage;
    _id_D70A5AD30766108E.mod = mod;
    _id_D70A5AD30766108E._id_65F518B1539B9262 = attacker geteye();
    _id_D70A5AD30766108E._id_96586EEC2364C35B = point;
    _id_D70A5AD30766108E.objweapon = objweapon;
    _id_D70A5AD30766108E.hitloc = hitloc;
    self _meth_909FA2C630F3E996( undefined );
    victim setcandamage( 0 );
    victim scripts\engine\utility::ent_flag_set( "bullet_cam_active" );
    attacker thread _id_652292CEF87D75A1( _id_D70A5AD30766108E );
    return 0;
}

_id_652292CEF87D75A1( _id_D70A5AD30766108E )
{
    player = self;
    player endon( "death" );
    victim = _id_D70A5AD30766108E.victim;
    _id_0EEF5466CE65CC22 = "bullet_cam";
    player _id_3B64EB40368C1450::set( _id_0EEF5466CE65CC22, "show_hud", 0 );
    player scripts\engine\utility::delaythread( 0.25, ::_id_562E3DD74DAA00A8, _id_0EEF5466CE65CC22 );
    _id_E24F4429BBD78DFF = player _id_CE36337F8C717E61( _id_D70A5AD30766108E );
    player _id_997DF78F32B188D1( _id_E24F4429BBD78DFF, _id_D70A5AD30766108E );
    player _id_C801064006290A9F( _id_E24F4429BBD78DFF, _id_D70A5AD30766108E );
    player _id_384BFBE6F6BB6658( _id_E24F4429BBD78DFF );
    player _id_3B64EB40368C1450::_id_C9D0B43701BDBA00( _id_0EEF5466CE65CC22 );
}

_id_562E3DD74DAA00A8( _id_89E9F545FB8C88C1 )
{
    player = self;
    player _id_3B64EB40368C1450::set( _id_89E9F545FB8C88C1, "damage", 0 );
    player _id_3B64EB40368C1450::set( _id_89E9F545FB8C88C1, "freezecontrols", 1 );
}

_id_CE36337F8C717E61( _id_D70A5AD30766108E )
{
    player = self;
    _id_93E7C2B13BFC6E84 = vectornormalize( _id_D70A5AD30766108E._id_96586EEC2364C35B - _id_D70A5AD30766108E._id_65F518B1539B9262 );
    startpos = _id_D70A5AD30766108E._id_65F518B1539B9262 + _id_93E7C2B13BFC6E84 * 5;
    endpos = _id_D70A5AD30766108E._id_96586EEC2364C35B + _id_93E7C2B13BFC6E84 * -30;
    _id_B8A6D50126979CF3 = scripts\engine\utility::spawn_tag_origin( startpos, vectortoangles( _id_93E7C2B13BFC6E84 ) );
    _id_2B8BFAB9345DD436 = scripts\engine\utility::spawn_tag_origin( startpos, _id_B8A6D50126979CF3.angles );
    _id_2B8BFAB9345DD436 linkto( _id_B8A6D50126979CF3, "tag_origin", ( -5, 0, 1 ), ( 0, 0, 0 ) );
    _id_39CD708E0DE10E20 = spawn( "script_model", startpos );
    _id_39CD708E0DE10E20.angles = _id_B8A6D50126979CF3.angles;
    _id_39CD708E0DE10E20 setmodel( "military_bullet_armor_pierce" );
    player cameralinkto( _id_2B8BFAB9345DD436, "tag_origin", 1, 1 );
    _id_E24F4429BBD78DFF = spawnstruct();
    _id_E24F4429BBD78DFF.startpos = startpos;
    _id_E24F4429BBD78DFF.endpos = endpos;
    _id_E24F4429BBD78DFF._id_93E7C2B13BFC6E84 = _id_93E7C2B13BFC6E84;
    _id_E24F4429BBD78DFF._id_B8A6D50126979CF3 = _id_B8A6D50126979CF3;
    _id_E24F4429BBD78DFF._id_2B8BFAB9345DD436 = _id_2B8BFAB9345DD436;
    _id_E24F4429BBD78DFF._id_39CD708E0DE10E20 = _id_39CD708E0DE10E20;
    return _id_E24F4429BBD78DFF;
}

_id_997DF78F32B188D1( _id_E24F4429BBD78DFF, _id_D70A5AD30766108E )
{
    player = self;
    _id_42F65B4B53C1F5D4 = length( _id_E24F4429BBD78DFF.endpos - _id_E24F4429BBD78DFF.startpos ) / 1500;
    _id_E24F4429BBD78DFF._id_B8A6D50126979CF3 moveto( _id_E24F4429BBD78DFF.endpos, _id_42F65B4B53C1F5D4 );
    _id_E24F4429BBD78DFF._id_39CD708E0DE10E20 moveto( _id_E24F4429BBD78DFF.endpos, _id_42F65B4B53C1F5D4 );
    _id_E24F4429BBD78DFF._id_39CD708E0DE10E20 rotatevelocity( ( 0, 0, -4000 ), 9999 );
    wait 0.1;
    setslowmotion( 1.0, 0.5, 0.1 );
    wait( _id_42F65B4B53C1F5D4 - 0.1 );
    _id_E24F4429BBD78DFF._id_B8A6D50126979CF3 moveto( _id_D70A5AD30766108E._id_96586EEC2364C35B, 0.6, 0, 0.2 );
    _id_E24F4429BBD78DFF._id_39CD708E0DE10E20 moveto( _id_D70A5AD30766108E._id_96586EEC2364C35B, 0.6, 0, 0.2 );
    _id_E24F4429BBD78DFF._id_39CD708E0DE10E20 rotatevelocity( ( 0, 0, 400 ), 9999 );
    waitframe();
    setslowmotion( 0.5, 0.1, 0.5 );
    wait 0.2;
}

_id_C801064006290A9F( _id_E24F4429BBD78DFF, _id_D70A5AD30766108E )
{
    player = self;
    victim = _id_D70A5AD30766108E.victim;
    victim setcandamage( 1 );
    victim dodamage( victim.maxhealth * 2, _id_D70A5AD30766108E._id_96586EEC2364C35B, player, undefined, _id_D70A5AD30766108E.mod, _id_D70A5AD30766108E.objweapon, _id_D70A5AD30766108E.hitloc );
    playfx( scripts\engine\utility::getfx( "bullet_cam_flesh_impact" ), _id_D70A5AD30766108E._id_96586EEC2364C35B, _id_E24F4429BBD78DFF._id_93E7C2B13BFC6E84 * -1 );
    _id_E24F4429BBD78DFF._id_2B8BFAB9345DD436 unlink();
    _id_E24F4429BBD78DFF._id_39CD708E0DE10E20 delete();
    _id_E24F4429BBD78DFF._id_B8A6D50126979CF3 delete();
    _id_BEF607E60DBC7521 = rotatevector( _id_E24F4429BBD78DFF._id_93E7C2B13BFC6E84, ( 0, 90, 0 ) );
    _id_C8DC35D050ECA3EC = _id_D70A5AD30766108E._id_96586EEC2364C35B + _id_BEF607E60DBC7521 * 150;
    _id_EF2935144E836EA5 = _id_C8DC35D050ECA3EC + _id_E24F4429BBD78DFF._id_93E7C2B13BFC6E84 * -60;
    _id_D230A844C1FA4ABC = _id_C8DC35D050ECA3EC + _id_E24F4429BBD78DFF._id_93E7C2B13BFC6E84 * 20;
    _id_E24F4429BBD78DFF._id_2B8BFAB9345DD436 dontinterpolate();
    _id_E24F4429BBD78DFF._id_2B8BFAB9345DD436.origin = _id_EF2935144E836EA5;
    _id_E24F4429BBD78DFF._id_2B8BFAB9345DD436.angles = vectortoangles( -1 * _id_BEF607E60DBC7521 );
    _id_E24F4429BBD78DFF._id_2B8BFAB9345DD436 moveto( _id_C8DC35D050ECA3EC, 0.15 );
    setslowmotion( 0.1, 1.0, 0.5 );
    wait 0.15;
    _id_E24F4429BBD78DFF._id_2B8BFAB9345DD436 moveto( _id_D230A844C1FA4ABC, 0.5 );
    setslowmotion( 1.0, 0.2, 0.5 );
    wait 0.5;
}

_id_384BFBE6F6BB6658( _id_E24F4429BBD78DFF )
{
    player = self;
    setslowmotion( 0.1, 1.0, 0.1 );
    waitframe();
    player cameraunlink();

    if ( isdefined( _id_E24F4429BBD78DFF._id_39CD708E0DE10E20 ) )
        _id_E24F4429BBD78DFF._id_39CD708E0DE10E20 delete();

    if ( isdefined( _id_E24F4429BBD78DFF._id_2B8BFAB9345DD436 ) )
        _id_E24F4429BBD78DFF._id_2B8BFAB9345DD436 delete();

    if ( isdefined( _id_E24F4429BBD78DFF._id_B8A6D50126979CF3 ) )
        _id_E24F4429BBD78DFF._id_B8A6D50126979CF3 delete();
}
