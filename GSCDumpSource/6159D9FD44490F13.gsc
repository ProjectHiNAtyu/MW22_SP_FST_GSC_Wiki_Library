// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

equipmentinteract_init()
{
    level.useobjs = [];
    scripts\cp_mp\utility\script_utility::registersharedfunc( "equipment", "deployHackTablet", ::_id_5FC869C3F6D7257B );
    scripts\engine\scriptable::scriptable_addusedcallbackbypart( "hack_usable", ::equipmentscriptableused );
    thread _updateuseobjs();
}

equipmentscriptableused( instance, part, state, player, _id_A5B2C541413AA895, _id_CC38472E36BE1B61 )
{
    equipmentuse( instance.entity, player );
}

equipmentuse( instance, player )
{
    equipment = instance;
    equipment.isbeingused = 1;

    if ( isdefined( player ) )
    {
        player.iscapturingcrate = 0;
        player.ishacking = 1;
        streakinfo = player scripts\cp_mp\utility\killstreak_utility::createstreakinfo( "", player );
        streakinfo.interactstate = 0;
        player thread _id_5FC869C3F6D7257B( _id_BE0C3A067DA1E72D( equipment ), equipment, streakinfo );
    }
}

_updateuseobjs()
{
    level endon( "game_ended" );

    for (;;)
    {
        wait 0.2;

        foreach ( useobj in level.useobjs )
        {
            if ( !isdefined( useobj ) )
                continue;

            _id_EF269077A28646EB = scripts\common\utility::playersnear( useobj.origin, 300 );

            foreach ( player in _id_EF269077A28646EB )
            {
                if ( !istrue( scripts\cp_mp\utility\player_utility::playersareenemies( player, useobj.owner ) ) || istrue( useobj.isbeingused ) || scripts\cp_mp\utility\script_utility::issharedfuncdefined( "perk", "hasPerk" ) && !player [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "perk", "hasPerk" ) ]]( "specialty_hack" ) || player scripts\cp_mp\emp_debuff::is_empd() || player _id_098B53A7358927D9::_id_C4D8558FC1592CD6() || level.gameended )
                {
                    useobj disablescriptableplayeruse( player );
                    continue;
                }

                useobj enablescriptableplayeruse( player );
            }
        }
    }
}

remoteinteractsetup( _id_3012AB4936B3FDEC, _id_6E8DE967563C281C, _id_93AF2771622642D7 )
{
    if ( isdefined( _id_93AF2771622642D7 ) || _id_93AF2771622642D7 )
        thread _hacksetup( _id_3012AB4936B3FDEC );
}

_hacksetup( remotedefusecallback )
{
    level.useobjs[self getentitynumber()] = self;
    self setscriptablepartstate( "hack_usable", "on" );

    foreach ( player in level.players )
        self disablescriptableplayeruse( player );
}

_processusethink( equipment )
{
    level endon( "game_ended" );

    if ( isdefined( equipment ) )
    {
        equipment endon( "death" );
        equipment endon( "mine_triggered" );
    }

    self endon( "death_or_disconnect" );
    self endon( "emp_started" );
    _id_FBC7CCE627CB4D4F = ( getdvarfloat( "dvar_B22BB1A48299003B", 3.0 ) - getdvarfloat( "dvar_F1B36A05BC8C07AF", 0.5 ) ) * 1000;
    _id_B8CF204DD62D457F = gettime() + _id_FBC7CCE627CB4D4F;

    while ( _id_B8CF204DD62D457F > gettime() )
    {
        if ( !self usebuttonpressed() )
            return 0;

        waitframe();
    }

    return 1;
}

_startusethink( equipment, streakinfo )
{
    if ( isdefined( equipment ) )
        equipment.isbeingused = 1;

    self.iscapturingcrate = 1;
    self.ishacking = 1;
    streakinfo.interactstate = 0;
    self notify( "interact_started" );
    result = istrue( _processusethink( equipment ) );

    if ( result )
        streakinfo.interactstate = 2;
    else
        self notify( "interact_cancelled" );

    self notify( "interact_finished" );

    if ( isdefined( equipment ) )
        equipment.isbeingused = 0;

    if ( isdefined( self ) )
    {
        self.iscapturingcrate = 0;
        self.ishacking = undefined;

        if ( !istrue( result ) )
            return;

        if ( isdefined( equipment ) )
        {
            if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "equipment", "hackEquipment" ) )
                equipment [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "equipment", "hackEquipment" ) ]]( self );
        }
    }
}

_id_BE0C3A067DA1E72D( equipment )
{
    index = -1;

    if ( isdefined( equipment.equipmentref ) )
    {
        if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "equipment", "getEquipmentTableInfo" ) )
            index = [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "equipment", "getEquipmentTableInfo" ) ]]( equipment.equipmentref ).id;
    }
    else if ( isdefined( equipment.streakinfo ) )
    {
        if ( scripts\cp_mp\utility\script_utility::issharedfuncdefined( "killstreak", "getKillstreakIndex" ) )
            index = [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "killstreak", "getKillstreakIndex" ) ]]( equipment.streakinfo.streakname );

        index = index + 100;
    }

    return index;
}

_id_5FC869C3F6D7257B( index, equipment, streakinfo )
{
    level endon( "game_ended" );
    self endon( "disconnect" );
    weaponobj = makeweapon( "ks_remote_hack_mp" );
    thread _id_C9ADA01DC3EAC7F3( index );
    _id_41BF9BF4918115AC = scripts\cp_mp\killstreaks\killstreakdeploy::switchtodeployweapon( weaponobj, streakinfo, ::_waituntilinteractfinished, ::_ontabletgiven, undefined, undefined, ::_ontabletputaway );

    if ( istrue( _id_41BF9BF4918115AC ) )
        thread _startusethink( equipment, streakinfo );
    else
    {
        self notify( "interact_cancelled" );

        if ( isdefined( equipment ) )
            equipment.isbeingused = 0;
    }
}

_id_C9ADA01DC3EAC7F3( _id_C9F312275B852AB0 )
{
    level endon( "game_ended" );
    self endon( "disconnect" );
    self setclientomnvar( "ui_hack_index", _id_C9F312275B852AB0 );
    self playlocalsound( "iw8_eod_tablet_ui" );
    _updatehackprogressomnvar();
    self stoplocalsound( "iw8_eod_tablet_ui" );
    self setclientomnvar( "ui_hack_progress", 0 );
    wait 0.1;
    self setclientomnvar( "ui_hack_index", 0 );
}

_updatehackprogressomnvar()
{
    self endon( "interact_cancelled" );
    self waittill( "interact_started" );
    _id_2646E75E629259A6 = 1000.0;
    _id_137D951E4D233A68 = 500.0;
    _id_84FDEEC8CD47B94C = getdvarfloat( "dvar_B22BB1A48299003B", 3.0 ) * 1000;
    _id_6CDA039F5C3A871C = getdvarfloat( "dvar_F1B36A05BC8C07AF", 0.5 ) * 1000;
    _id_38CCC24FE3351B52 = _id_84FDEEC8CD47B94C - _id_2646E75E629259A6 - _id_6CDA039F5C3A871C;
    _id_B8CF204DD62D457F = gettime() + _id_84FDEEC8CD47B94C + _id_137D951E4D233A68;
    _id_B7EB0C292517D42D = gettime() + _id_2646E75E629259A6;

    for (;;)
    {
        _id_A8F34796FC188F71 = ( gettime() - _id_B7EB0C292517D42D ) / _id_38CCC24FE3351B52;
        _id_A8F34796FC188F71 = clamp( _id_A8F34796FC188F71, 0, 1 );
        self setclientomnvar( "ui_hack_progress", _id_A8F34796FC188F71 );
        wait 0.05;

        if ( gettime() > _id_B8CF204DD62D457F )
            break;
    }
}

_ontabletgiven( streakinfo, _id_41BF9BF4918115AC )
{
    _toggletabletallows( 1 );
    thread _cleanuptabletallows();
    thread _cancelputawayonuseend( streakinfo );
    return 1;
}

_cancelputawayonuseend( streakinfo )
{
    level endon( "game_ended" );
    self endon( "death_or_disconnect" );
    streakinfo endon( "deploy_weapon_switch_ended" );

    for (;;)
    {
        if ( !self usebuttonpressed() )
            break;

        waitframe();
    }

    self notify( "cancel_all_killstreak_deployments" );
}

_ontabletputaway( streakinfo )
{
    self notify( "tabletPutAway" );
}

_waituntilinteractfinished( streakinfo )
{
    level endon( "game_ended" );
    self endon( "death_or_disconnect" );
    self endon( "interact_cancelled" );

    if ( streakinfo.interactstate != 0 )
        return;

    self waittill( "interact_finished" );

    if ( streakinfo.interactstate == 2 )
    {
        _id_3504D7A7F76AD9D5 = getdvarfloat( "dvar_F1B36A05BC8C07AF", 0.5 );
        wait( _id_3504D7A7F76AD9D5 );
    }
}

_cleanuptabletallows()
{
    level endon( "game_ended" );
    self endon( "disconnect" );
    scripts\engine\utility::waittill_any_2( "death", "tabletPutAway" );
    _toggletabletallows( 0 );
}

_toggletabletallows( _id_DA3010AF8F6BE463 )
{
    scripts\cp_mp\utility\player_utility::_freezelookcontrols( _id_DA3010AF8F6BE463 );

    if ( isalive( self ) )
    {
        if ( _id_DA3010AF8F6BE463 )
        {
            _id_3B64EB40368C1450::set( "tablet", "allow_movement", 0 );
            _id_3B64EB40368C1450::set( "tablet", "allow_jump", 0 );
            _id_3B64EB40368C1450::set( "tablet", "usability", 0 );
            _id_3B64EB40368C1450::set( "tablet", "melee", 0 );
            _id_3B64EB40368C1450::set( "tablet", "offhand_weapons", 0 );
        }
        else
            _id_3B64EB40368C1450::_id_C9D0B43701BDBA00( "tablet" );
    }
}
