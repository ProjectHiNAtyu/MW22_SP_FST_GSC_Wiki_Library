// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

battle_tracks_onentervehicle( vehicle, player )
{
    battle_tracks_stopbattletrackswhenstandingonvehicle( player );

    if ( battle_tracks_shouldstartbattletracks( vehicle ) )
        battle_tracks_playbattletrackstoplayer( vehicle, player );
}

battle_tracks_vehicleoccupancyenter( vehicle, player, seatid, _id_FC7C7A874B43A31A )
{
    _id_DF653126C71EF4CA = scripts\cp_mp\vehicles\vehicle_occupancy::vehicle_occupancy_isdriverseat( vehicle, seatid );
    _id_10E0F337938FCFA6 = battle_tracks_isbattletracksowner( vehicle, player );
    battle_tracks_trystopdrivertogglethink( vehicle, player, _id_FC7C7A874B43A31A );
    battle_tracks_hidetogglewidget( player );

    if ( _id_DF653126C71EF4CA )
    {
        if ( !_id_10E0F337938FCFA6 )
        {
            battle_tracks_stopbattletrackstoalloccupants( vehicle );
            battle_tracks_updatebattletracks( vehicle, player );
        }

        if ( battle_tracks_shouldstartbattletracks( vehicle ) )
            battle_tracks_playbattletrackstoalloccupants( vehicle );

        if ( !battle_tracks_hasemptybattletracks( vehicle ) )
            player thread battle_tracks_togglethink( player, vehicle );
    }
}

battle_tracks_onexitvehicle( vehicle, player, seatid )
{
    battle_tracks_stopbattletracksforplayer( vehicle.battletracksmusicstate, player );
    battle_tracks_trystopdrivertogglethink( vehicle, player, seatid );
    battle_tracks_hidetogglewidget( player );
    _id_10E0F337938FCFA6 = battle_tracks_isbattletracksowner( vehicle, player );

    if ( _id_10E0F337938FCFA6 )
    {
        battle_tracks_stopbattletrackstoalloccupants( vehicle );
        battle_tracks_clearbattletracks( vehicle );
    }
}

battle_tracks_monitorstandingonvehicles( player )
{
    level endon( "game_ended" );
    player endon( "disconnect" );

    for (;;)
    {
        battle_tracks_tryplayingbattletrackswhenstandingonvehicle( player );
        wait 0.5;
    }
}

battle_tracks_updatebattletracks( vehicle, player )
{
    vehicle.battletracks = [];
    vehicle.battletracksowner = player;
    vehicle.battletracksmusicstate = "";

    if ( battle_tracks_playerselectrandomtracks( vehicle, player ) )
        battle_tracks_updatebattletracksfromplayerdata( vehicle, player, 1, 9 );
    else
        battle_tracks_updatebattletracksfromplayerdata( vehicle, player, 0, 0 );
}

battle_tracks_updatebattletracksfromplayerdata( vehicle, player, _id_2F55781AF96F22F9, _id_8FA62807749C3F5A )
{
    for ( _id_109EBF347B2F2ECE = _id_2F55781AF96F22F9; _id_109EBF347B2F2ECE <= _id_8FA62807749C3F5A; _id_109EBF347B2F2ECE++ )
    {
        _id_0534056C7A3B8C64 = battle_tracks_gettrackindex( vehicle, player, _id_109EBF347B2F2ECE );

        if ( isdefined( _id_0534056C7A3B8C64 ) )
        {
            _id_A244F2F1E8CAC724 = battle_tracks_getsfxalias( _id_0534056C7A3B8C64 );

            if ( _id_A244F2F1E8CAC724 != "" )
            {
                vehicle.battletracks = scripts\engine\utility::array_add( vehicle.battletracks, _id_A244F2F1E8CAC724 );
                battle_tracks_setmusicstate( vehicle, _id_0534056C7A3B8C64 );
            }
        }
    }
}

battle_tracks_setmusicstate( vehicle, _id_0534056C7A3B8C64 )
{
    _id_51941101270F867D = battle_tracks_getmusicstate( _id_0534056C7A3B8C64 );

    if ( vehicle.battletracksmusicstate == "" )
        vehicle.battletracksmusicstate = _id_51941101270F867D;
    else
    {

    }
}

battle_tracks_playerselectrandomtracks( vehicle, player )
{
    _id_5CD83EED6CC7ED18 = battle_tracks_gettrackindex( vehicle, player, 0 );
    return isdefined( _id_5CD83EED6CC7ED18 ) && _id_5CD83EED6CC7ED18 == 1;
}

battle_tracks_gettrackindex( vehicle, player, _id_109EBF347B2F2ECE )
{
    data = scripts\cp_mp\vehicles\vehicle::_id_86F6F784630B11FB( vehicle scripts\cp_mp\vehicles\vehicle::_id_D93EC4635290FEBD() );

    if ( isdefined( data ) )
    {
        _id_0534056C7A3B8C64 = player getplayerdata( level.loadoutsgroup, "customizationSetup", "vehicleCustomization", data.ref, "tracks", _id_109EBF347B2F2ECE );
        return _id_0534056C7A3B8C64;
    }
    else
        return undefined;
}

battle_tracks_getsfxalias( _id_0534056C7A3B8C64 )
{
    result = tablelookup( "mp_cp/vehicletracks.csv", 0, _id_0534056C7A3B8C64, 7 );
    return result;
}

battle_tracks_getmusicstate( _id_0534056C7A3B8C64 )
{
    result = tablelookup( "mp_cp/vehicletracks.csv", 0, _id_0534056C7A3B8C64, 8 );
    return result;
}

battle_tracks_playbattletrackstoalloccupants( vehicle )
{
    _id_6E62512E935B6EEB = scripts\cp_mp\vehicles\vehicle_occupancy::vehicle_occupancy_getalloccupants( vehicle, 1 );

    foreach ( _id_F85572CD5F6117C6 in _id_6E62512E935B6EEB )
        battle_tracks_playbattletrackstoplayer( vehicle, _id_F85572CD5F6117C6 );
}

battle_tracks_stopbattletrackstoalloccupants( vehicle )
{
    _id_6E62512E935B6EEB = scripts\cp_mp\vehicles\vehicle_occupancy::vehicle_occupancy_getalloccupants( vehicle, 1 );

    foreach ( _id_F85572CD5F6117C6 in _id_6E62512E935B6EEB )
        battle_tracks_stopbattletracksforplayer( vehicle.battletracksmusicstate, _id_F85572CD5F6117C6 );
}

battle_tracks_playbattletrackstoplayer( vehicle, player )
{
    _id_10E0F337938FCFA6 = battle_tracks_isbattletracksowner( vehicle, player );

    if ( isdefined( vehicle.battletracksmusicstate ) && isdefined( vehicle.battletracks ) && isdefined( player ) && ( _id_10E0F337938FCFA6 || player getwartrackpassengerenabled() ) )
    {
        player stopplayermusicstate( vehicle.battletracksmusicstate );
        player setplayermusicstate( vehicle.battletracksmusicstate, vehicle.battletracks );
    }
}

battle_tracks_stopbattletracksforplayer( battletracksmusicstate, player )
{
    if ( isdefined( battletracksmusicstate ) && isdefined( player ) )
        player stopplayermusicstate( battletracksmusicstate );
}

battle_tracks_isbattletracksowner( vehicle, player )
{
    return isdefined( vehicle.battletracksowner ) && vehicle.battletracksowner == player;
}

battle_tracks_clearbattletracks( vehicle )
{
    vehicle.battletracksowner = undefined;
    vehicle.battletracks = undefined;
    vehicle.battletracksmusicstate = undefined;
}

battle_tracks_hasemptybattletracks( vehicle )
{
    if ( !isdefined( vehicle.battletracks ) )
        return 1;

    if ( vehicle.battletracks.size == 0 )
        return 1;

    return 0;
}

battle_tracks_togglethink( player, vehicle )
{
    player notify( "stop_battle_tracks_toggle_think" );
    player endon( "stop_battle_tracks_toggle_think" );
    player endon( "death_or_disconnect" );
    player endon( "last_stand_start" );
    battle_tracks_tryinittogglestate( player );
    _id_4844D16E0D10F08B = battle_tracks_gettogglestate( player );
    battle_tracks_updatetogglestate( player, vehicle, _id_4844D16E0D10F08B );

    if ( player scripts\engine\utility::is_player_gamepad_enabled() )
        player notifyonplayercommand( "update_battle_tracks_toggle_state", "+stance" );
    else
        player notifyonplayercommand( "update_battle_tracks_toggle_state", "nightvision" );

    for (;;)
    {
        player waittill( "update_battle_tracks_toggle_state" );
        _id_EAECA8280194353E = battle_tracks_getnewtogglestate( player );
        battle_tracks_updatetogglestate( player, vehicle, _id_EAECA8280194353E );
    }
}

battle_tracks_updatetogglestate( player, vehicle, _id_D1D3327F51ED4342 )
{
    switch ( _id_D1D3327F51ED4342 )
    {
        case "on":
            battle_tracks_toggleonstate( player, vehicle );
            break;
        case "off":
            battle_tracks_toggleoffstate( player, vehicle );
            break;
    }
}

battle_tracks_toggleonstate( player, vehicle )
{
    battle_tracks_settogglestate( player, "on" );
    battle_tracks_playbattletrackstoalloccupants( vehicle );
}

battle_tracks_toggleoffstate( player, vehicle )
{
    battle_tracks_settogglestate( player, "off" );
    battle_tracks_stopbattletrackstoalloccupants( vehicle );
}

battle_tracks_getnewtogglestate( player )
{
    switch ( player.pers["battleTracksToggleState"] )
    {
        case "on":
            return "off";
        case "off":
            return "on";
    }
}

battle_tracks_tryinittogglestate( player )
{
    if ( !isdefined( player.pers["battleTracksToggleState"] ) )
        battle_tracks_settogglestate( player, "on" );
}

battle_tracks_settogglestate( player, value )
{
    player.pers["battleTracksToggleState"] = value;
    _id_587830FD4042BE45 = player getclientomnvar( "ui_veh_battle_tracks_toggle_state" );

    switch ( value )
    {
        case "on":
            player setclientomnvar( "ui_veh_battle_tracks_toggle_state", 1 );
            break;
        case "off":
            player setclientomnvar( "ui_veh_battle_tracks_toggle_state", 2 );
            break;
    }
}

battle_tracks_hidetogglewidget( player )
{
    if ( isdefined( player ) )
    {
        _id_587830FD4042BE45 = player getclientomnvar( "ui_veh_battle_tracks_toggle_state" );
        player setclientomnvar( "ui_veh_battle_tracks_toggle_state", 0 );
    }
}

battle_tracks_gettogglestate( player )
{
    return player.pers["battleTracksToggleState"];
}

battle_tracks_togglestateis( player, value )
{
    return isdefined( player.pers["battleTracksToggleState"] ) && player.pers["battleTracksToggleState"] == value;
}

battle_tracks_trystopdrivertogglethink( vehicle, player, seatid )
{
    _id_DF653126C71EF4CA = isdefined( seatid ) && scripts\cp_mp\vehicles\vehicle_occupancy::vehicle_occupancy_isdriverseat( vehicle, seatid );

    if ( _id_DF653126C71EF4CA )
        player battle_tracks_stoptogglethink( player );
}

battle_tracks_stoptogglethink( player )
{
    player notify( "stop_battle_tracks_toggle_think" );
}

battle_tracks_shouldstartbattletracks( vehicle )
{
    if ( battle_tracks_hasemptybattletracks( vehicle ) )
        return 0;

    if ( isdefined( vehicle.battletracksowner ) && battle_tracks_togglestateis( vehicle.battletracksowner, "off" ) )
        return 0;

    return 1;
}

battle_tracks_tryplayingbattletrackswhenstandingonvehicle( player )
{
    vehicle = player getmovingplatformparent();

    if ( battle_tracks_shouldplaybattletrackswhenstandingonvehicle( vehicle, player ) )
    {
        player thread battle_tracks_standingonvehicletimeout( vehicle, player );

        if ( !battle_tracks_standingonsamevehiclewithsametracksowner( vehicle, player ) )
        {
            battle_tracks_stopbattletrackswhenstandingonvehicle( player );
            battle_tracks_playbattletrackswhenstandingonvehicle( vehicle, player );
        }
    }
}

battle_tracks_playbattletrackswhenstandingonvehicle( vehicle, player )
{
    player.battletracksmusicstatestandingonvehicle = vehicle.battletracksmusicstate;
    player.battletracksidstandingonvehicle = battle_tracks_getbattletracksid( vehicle );
    battle_tracks_playbattletrackstoplayer( vehicle, player );
}

battle_tracks_stopbattletrackswhenstandingonvehicle( player )
{
    if ( isdefined( player.battletracksmusicstatestandingonvehicle ) )
    {
        player notify( "battle_tracks_standingOnVehicleTimeout" );
        battle_tracks_stopbattletracksfromstandingonvehicle( player );
    }
}

battle_tracks_standingonvehicletimeout( vehicle, player )
{
    level endon( "game_ended" );
    player endon( "disconnect" );
    player notify( "battle_tracks_standingOnVehicleTimeout" );
    player endon( "battle_tracks_standingOnVehicleTimeout" );
    wait 1;
    battle_tracks_stopbattletracksfromstandingonvehicle( player );
}

battle_tracks_stopbattletracksfromstandingonvehicle( player )
{
    battle_tracks_stopbattletracksforplayer( player.battletracksmusicstatestandingonvehicle, player );
    player.battletracksmusicstatestandingonvehicle = undefined;
    player.battletracksidstandingonvehicle = undefined;
}

battle_tracks_shouldplaybattletrackswhenstandingonvehicle( vehicle, player )
{
    if ( !isdefined( vehicle ) )
        return 0;

    if ( !vehicle scripts\cp_mp\vehicles\vehicle::isvehicle() )
        return 0;

    if ( !battle_tracks_vehicleallowlisteningoutsideoccupancy( vehicle ) )
        return 0;

    if ( !scripts\cp_mp\vehicles\vehicle::vehicle_isfriendlytoplayer( vehicle, player ) )
        return 0;

    if ( !battle_tracks_shouldstartbattletracks( vehicle ) )
        return 0;

    if ( !battle_tracks_playerinlisteningzone( vehicle, player ) )
        return 0;

    return 1;
}

battle_tracks_standingonsamevehiclewithsametracksowner( vehicle, player )
{
    if ( !isdefined( player.battletracksidstandingonvehicle ) )
        return 0;

    _id_B132B6A670ABB56E = battle_tracks_getbattletracksid( vehicle );
    return _id_B132B6A670ABB56E == player.battletracksidstandingonvehicle;
}

battle_tracks_getbattletracksid( vehicle )
{
    _id_F794F29935653F3E = vehicle getentitynumber() + "";
    _id_D92A58C3390F0FF2 = vehicle.battletracksowner getentitynumber() + "";
    return _id_F794F29935653F3E + _id_D92A58C3390F0FF2;
}

battle_tracks_playerinlisteningzone( vehicle, player )
{
    switch ( vehicle.targetname )
    {
        case "cargo_truck_mg":
        case "cargo_truck":
            return scripts\cp_mp\utility\train_utility::isplayerinsiderectangularzonebasedonent( player, vehicle, "tag_origin", -85, 0, 77, 185, 125, 40 );
        default:
            return 0;
    }
}

battle_tracks_vehicleallowlisteningoutsideoccupancy( vehicle )
{
    if ( isdefined( vehicle.targetname ) )
    {
        switch ( vehicle.targetname )
        {
            case "cargo_truck_mg":
            case "cargo_truck":
                return 1;
            default:
                return 0;
        }
    }
    else
        return 0;
}
