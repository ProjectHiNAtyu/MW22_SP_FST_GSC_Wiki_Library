// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

_id_FB7271D5EE18B98D( data )
{
    scripts\engine\scriptable::scriptable_addusedcallbackbypart( "body", ::scavengerlootcacheused );
    level._id_CF05AFB32024800A = spawnstruct();
    level._id_CF05AFB32024800A.time = getdvarint( "dvar_5802E08D3A73518F", 300 );
    level._id_CF05AFB32024800A._id_697B16D5E1CB65E3 = getdvarint( "dvar_1EAF2EF86C1344E8", 3 );
    level._id_CF05AFB32024800A._id_76FBB523B032ED22 = getdvarint( "dvar_40502E1CCC8AFEE2", 10000 );
    level._id_CF05AFB32024800A._id_5E8448F4B9E71CB4 = getdvarint( "dvar_6CF95A3CC8A2C6BC", 0 );
    level._id_CF05AFB32024800A._id_B90DC65A569F4825 = getdvarint( "dvar_0A438440CE7CE72C", 4000 );
    level._id_CF05AFB32024800A._id_7F34783FC18F8A33 = getdvarint( "dvar_8CE4DAAF96793442", 2000 );
    game["dialog"]["mission_scav_accept"] = "mission_mission_scav_accept";
    game["dialog"]["mission_scav_success"] = "mission_mission_scav_success";
    data.funcs["onInit"] = ::_id_591E6AB6447B07BE;
    data.funcs["onTeamAssigned"] = ::_id_F6F80C11D5D8EAF5;
}

_id_591E6AB6447B07BE()
{
    if ( !isdefined( self._id_3B1ED2AB5FEE3E31 ) )
        return _id_549AB791FA91C7AC();

    return 1;
}

_id_549AB791FA91C7AC()
{
    if ( !isdefined( self._id_3B1ED2AB5FEE3E31 ) )
        self._id_3B1ED2AB5FEE3E31 = [];

    if ( !isdefined( self._id_003BB6053DB23449 ) )
        self._id_003BB6053DB23449 = 0;

    _id_5680465E80D5127C = _id_9F225E14BFF0629F();

    if ( !isdefined( _id_5680465E80D5127C ) )
        return 0;

    for ( _id_AC0E594AC96AA3A8 = 0; _id_AC0E594AC96AA3A8 < level._id_CF05AFB32024800A._id_697B16D5E1CB65E3; _id_AC0E594AC96AA3A8++ )
    {
        self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8] = spawnstruct();
        self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8]._id_2076A994E0E7C929 = _id_5680465E80D5127C[_id_AC0E594AC96AA3A8];
        self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8]._id_3B991F00E2E091E4 = 0;

        if ( !isdefined( self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8]._id_2076A994E0E7C929 ) )
        {
            self._id_3B1ED2AB5FEE3E31 = undefined;
            return 0;
        }

        disablelootspawnpoint( self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8]._id_2076A994E0E7C929.index );
    }

    return 1;
}

_id_F6F80C11D5D8EAF5()
{
    _id_64ACB6CE534155B7::uiobjectiveshowtoteam( "scavenger", self.teams[0] );

    foreach ( player in scripts\mp\utility\teams::getteamdata( self.teams[0], "players" ) )
        player _id_64ACB6CE534155B7::uiobjectivesetparameter( 0 );

    time = level._id_CF05AFB32024800A.time;
    time = _id_64ACB6CE534155B7::_id_9B6275085FBCB8F4( time );
    _id_64ACB6CE534155B7::_id_5A15174D34F0670C( time, 0 );
    thread _id_01E6E0E374F59D3D();

    if ( !isdefined( self._id_3B1ED2AB5FEE3E31 ) )
    {
        if ( !_id_549AB791FA91C7AC() )
            return 0;
    }

    for ( _id_AC0E594AC96AA3A8 = 0; _id_AC0E594AC96AA3A8 < level._id_CF05AFB32024800A._id_697B16D5E1CB65E3; _id_AC0E594AC96AA3A8++ )
    {
        _id_B038ED928EC17A81 = self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8]._id_2076A994E0E7C929;
        self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8].cacheentity = spawnscavengerlootcache( _id_B038ED928EC17A81.origin, _id_B038ED928EC17A81.angles );
        self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8] _id_64ACB6CE534155B7::createquestobjicon( "ui_mp_br_mapmenu_icon_scavengerhunt_objective", "current", self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8].cacheentity.origin + ( 0, 0, 65 ) );
        objective_removeallfrommask( self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8].objectiveiconid );
        objective_addteamtomask( self._id_3B1ED2AB5FEE3E31[_id_AC0E594AC96AA3A8].objectiveiconid, self.teams[0] );
    }

    _id_64ACB6CE534155B7::displayteamsplash( self.teams[0], "br_scavenger_quest_start_team" );
    _id_64ACB6CE534155B7::displaysquadmessagetoteam( self.teams[0], self._id_0D154AC2657C5F44, 6, _id_64ACB6CE534155B7::getquestindex( "scavenger" ) );
    level thread _id_2CEDCC356F1B9FC8::brleaderdialogteam( "mission_scav_accept", self.teams[0], 1 );
}

_id_810BBEDED8D1A801( success )
{
    self notify( "task_ended" );
    wait 1.0;
    deletescavengerhud();
    _id_64ACB6CE534155B7::_id_93663FE58D95F174( scripts\engine\utility::ter_op( istrue( success ), self.teams[0], undefined ) );
}

_id_01E6E0E374F59D3D()
{
    self endon( "task_ended" );
    level endon( "game_ended" );

    for ( _id_0F1A9809EED7E8F0 = gettime(); _id_0F1A9809EED7E8F0 < self.missiontime; _id_0F1A9809EED7E8F0 = gettime() )
        wait( ( self.missiontime - _id_0F1A9809EED7E8F0 ) / 1000.0 );

    params = spawnstruct();
    params.intvar = 0;
    _id_64ACB6CE534155B7::displayteamsplash( self.teams[0], "br_scavenger_quest_timer_expired", params );
    level thread _id_2CEDCC356F1B9FC8::brleaderdialogteam( "mission_gen_fail", self.teams[0], 1 );
    thread _id_810BBEDED8D1A801( 0 );
}

_id_4C7A7DD83180DE41( _id_7A180981CE616EF4, _id_76045CF7C0669684, _id_AA9D61F3C51B6A77, _id_5D186451F21D7020, maxrange, _id_B1DC32F87ABAA507, _id_54EDA05E274DB345 )
{
    nodes = _id_7A180981CE616EF4;
    _id_5FAA3DB092440B70 = [];
    _id_72C980F7C0F679D7 = randomfloatrange( _id_B1DC32F87ABAA507, _id_54EDA05E274DB345 );
    _id_FDC6EE1B91EBB7BF = _id_2695A20D4011076D::getmintimetillpointindangercircle( _id_AA9D61F3C51B6A77 );
    _id_06B50C4622758CC3 = undefined;
    _id_B88AA9CCEE86B6A3 = undefined;
    _id_6EA1418C4B1D7992 = undefined;

    foreach ( _id_FE8F7703F6313ED4, node in _id_7A180981CE616EF4 )
    {
        dist = abs( distance2d( _id_AA9D61F3C51B6A77, node.origin ) - _id_72C980F7C0F679D7 );

        if ( !_id_A067541E078900A5( node, _id_AA9D61F3C51B6A77, dist, _id_5D186451F21D7020, maxrange ) )
            continue;

        if ( !isdefined( _id_06B50C4622758CC3 ) || dist < _id_06B50C4622758CC3 )
        {
            _id_06B50C4622758CC3 = dist;
            _id_B88AA9CCEE86B6A3 = node;
            _id_6EA1418C4B1D7992 = _id_FE8F7703F6313ED4;
        }
    }

    if ( !isdefined( _id_B88AA9CCEE86B6A3 ) )
        return undefined;

    _id_5FAA3DB092440B70[0] = _id_B88AA9CCEE86B6A3;
    _id_B88AA9CCEE86B6A3.inuse = 1;
    disablelootspawnpoint( _id_6EA1418C4B1D7992 );

    if ( _id_76045CF7C0669684 == 1 )
        return _id_5FAA3DB092440B70;

    _id_DD557C73E4C85BC3 = _id_F469A8DCF7FFD6A8( _id_AA9D61F3C51B6A77, _id_B88AA9CCEE86B6A3.origin, _id_76045CF7C0669684 );
    _id_5D384C5F9EB5FC55 = [];

    for ( _id_AC0E594AC96AA3A8 = 0; _id_AC0E594AC96AA3A8 < _id_76045CF7C0669684 - 1; _id_AC0E594AC96AA3A8++ )
    {
        index = _id_AC0E594AC96AA3A8 + 1;
        _id_5D384C5F9EB5FC55[_id_AC0E594AC96AA3A8] = spawnstruct();
        _id_5D384C5F9EB5FC55[_id_AC0E594AC96AA3A8].index = index;
        _id_5D384C5F9EB5FC55[_id_AC0E594AC96AA3A8].point = _id_DD557C73E4C85BC3[index];
        _id_5D384C5F9EB5FC55[_id_AC0E594AC96AA3A8]._id_06B50C4622758CC3 = undefined;
        _id_5D384C5F9EB5FC55[_id_AC0E594AC96AA3A8]._id_B88AA9CCEE86B6A3 = undefined;
        _id_5D384C5F9EB5FC55[_id_AC0E594AC96AA3A8]._id_6B64CC5A249331EF = undefined;
    }

    _id_CDF6A925ECDC141D = 100;

    foreach ( _id_AE22245685C483AE in _id_5D384C5F9EB5FC55 )
    {
        foreach ( _id_FE8F7703F6313ED4, node in _id_7A180981CE616EF4 )
        {
            dist = distance2d( _id_AE22245685C483AE.point, node.origin );

            if ( !_id_A067541E078900A5( node, _id_AA9D61F3C51B6A77, dist, _id_5D186451F21D7020, maxrange ) )
                continue;

            if ( !isdefined( _id_AE22245685C483AE._id_06B50C4622758CC3 ) || dist < _id_AE22245685C483AE._id_06B50C4622758CC3 )
            {
                _id_AE22245685C483AE._id_06B50C4622758CC3 = dist;
                _id_AE22245685C483AE._id_B88AA9CCEE86B6A3 = node;
                _id_AE22245685C483AE._id_6B64CC5A249331EF = _id_FE8F7703F6313ED4;

                if ( dist <= _id_CDF6A925ECDC141D )
                    break;
            }
        }

        if ( !isdefined( _id_AE22245685C483AE.index ) || !isdefined( _id_AE22245685C483AE._id_B88AA9CCEE86B6A3 ) )
            return undefined;

        _id_5FAA3DB092440B70[_id_AE22245685C483AE.index] = _id_AE22245685C483AE._id_B88AA9CCEE86B6A3;
        _id_AE22245685C483AE._id_B88AA9CCEE86B6A3.inuse = 1;
        disablelootspawnpoint( _id_AE22245685C483AE._id_6B64CC5A249331EF );
    }

    return _id_5FAA3DB092440B70;
}

_id_A067541E078900A5( node, origin, dist, _id_5D186451F21D7020, maxrange )
{
    if ( istrue( node.inuse ) )
        return 0;

    if ( dist < _id_5D186451F21D7020 || dist > maxrange )
        return 0;

    if ( _id_4948CDF739393D2D::_id_F0201365C368CF88( node.origin ) )
        return 0;

    if ( !level.br_circle_disabled )
    {
        _id_E9C3B0DC909C640D = _id_2695A20D4011076D::getmintimetillpointindangercircle( origin );
        _id_28DEB7FF62E281D3 = _id_2695A20D4011076D::getmintimetillpointindangercircle( node.origin );

        if ( _id_28DEB7FF62E281D3 < _id_E9C3B0DC909C640D )
            return 0;

        _id_42F65B4B53C1F5D4 = dist / 190;
        _id_28DEB7FF62E281D3 = _id_28DEB7FF62E281D3 - _id_42F65B4B53C1F5D4;

        if ( _id_28DEB7FF62E281D3 < 30 )
            return 0;
    }

    return 1;
}

_id_F469A8DCF7FFD6A8( _id_D948C61DFDB971CB, point1, _id_0DB715BCDE296BEC )
{
    points = [];
    points[0] = point1;
    radius = distance2d( _id_D948C61DFDB971CB, point1 );
    _id_1394E0357BBB97D1 = 360 / _id_0DB715BCDE296BEC;
    _id_0423B19ADA56F4AD = [];
    _id_0423B19ADA56F4AD[0] = ( point1[0] - _id_D948C61DFDB971CB[0], point1[1] - _id_D948C61DFDB971CB[1], 0 );

    for ( _id_AC0E594AC96AA3A8 = 1; _id_AC0E594AC96AA3A8 < _id_0DB715BCDE296BEC; _id_AC0E594AC96AA3A8++ )
    {
        _id_575EDCD098B792A8 = points[_id_AC0E594AC96AA3A8 - 1];
        _id_088A81F800FB7B0D = _id_575EDCD098B792A8[0] - _id_D948C61DFDB971CB[0];
        _id_7B6B14E76B61F63E = _id_575EDCD098B792A8[1] - _id_D948C61DFDB971CB[1];
        x = _id_088A81F800FB7B0D * cos( _id_1394E0357BBB97D1 ) - _id_7B6B14E76B61F63E * sin( _id_1394E0357BBB97D1 );
        y = _id_7B6B14E76B61F63E * cos( _id_1394E0357BBB97D1 ) + _id_088A81F800FB7B0D * sin( _id_1394E0357BBB97D1 );
        _id_0423B19ADA56F4AD[_id_0423B19ADA56F4AD.size] = ( x, y, 0 );
        x = x + _id_D948C61DFDB971CB[0];
        y = y + _id_D948C61DFDB971CB[1];
        points[points.size] = ( x, y, 0 );
    }

    return points;
}

_id_9F225E14BFF0629F()
{
    locations = getunusedlootcachepoints( self.tablet.origin, level._id_CF05AFB32024800A._id_76FBB523B032ED22, level._id_CF05AFB32024800A._id_5E8448F4B9E71CB4, 1 );

    if ( locations.size == 0 )
        return undefined;

    return _id_4C7A7DD83180DE41( locations, level._id_CF05AFB32024800A._id_697B16D5E1CB65E3, self.tablet.origin, level._id_CF05AFB32024800A._id_5E8448F4B9E71CB4, level._id_CF05AFB32024800A._id_76FBB523B032ED22, level._id_CF05AFB32024800A._id_7F34783FC18F8A33, level._id_CF05AFB32024800A._id_B90DC65A569F4825 );
}

hidescavengerhudfromplayer( player )
{
    foreach ( _id_18FBB9618444B836 in self._id_3B1ED2AB5FEE3E31 )
    {
        if ( isdefined( _id_18FBB9618444B836.objectiveiconid ) )
            _id_18FBB9618444B836 _id_64ACB6CE534155B7::hidequestobjiconfromplayer( player );
    }

    player _id_64ACB6CE534155B7::uiobjectivehide();
}

deletescavengerhud()
{
    foreach ( player in scripts\mp\utility\teams::getteamdata( self.teams[0], "players" ) )
        hidescavengerhudfromplayer( player );

    foreach ( _id_18FBB9618444B836 in self._id_3B1ED2AB5FEE3E31 )
    {
        if ( isdefined( _id_18FBB9618444B836.objectiveiconid ) )
            _id_18FBB9618444B836 _id_64ACB6CE534155B7::deletequestobjicon();
    }
}

sq_ontimerexpired()
{
    _id_64ACB6CE534155B7::displayteamsplash( self.team, "br_scavenger_quest_timer_expired" );
    level thread _id_2CEDCC356F1B9FC8::brleaderdialogteam( "mission_gen_fail", self.team, 1 );
}

spawnscavengerlootcache( _id_7E05C139FBBD8374, _id_5B9C864B21207FF6 )
{
    cacheentity = spawn( "script_model", _id_7E05C139FBBD8374 );
    _id_7F599ACCB72658D1 = scripts\mp\utility\teams::getteamdata( self.teams[0], "players" )[0];
    cacheentity.angles = _id_5B9C864B21207FF6;
    cacheentity setotherent( _id_7F599ACCB72658D1 );
    cacheentity setmodel( "military_loot_crate_01_br_scavenger_01" );
    cacheentity setscriptablepartstate( "body", "scavenger_closed" );
    cacheentity._id_B8EBE3F71A08AB40 = self;

    foreach ( player in level.players )
    {
        if ( player != _id_7F599ACCB72658D1 && ( _id_7F599ACCB72658D1.team == "none" || player.team != _id_7F599ACCB72658D1.team ) )
            cacheentity disablescriptableplayeruse( player );
    }

    return cacheentity;
}

scavengerlootcacheused( instance, part, state, player, _id_A5B2C541413AA895, _id_CC38472E36BE1B61 )
{
    if ( istrue( player _id_362C58E8BB39BCDA::runbrgametypefunc( "playerSkipLootPickup", instance ) ) )
        return;

    if ( state == "scavenger_closed" && isdefined( instance.entity ) )
    {
        _id_B8EBE3F71A08AB40 = instance.entity._id_B8EBE3F71A08AB40;

        if ( player.team != _id_B8EBE3F71A08AB40.teams[0] )
        {
            player iprintlnbold( "Chest Requires a Scavenger Mission" );
            return;
        }

        instance setscriptablepartstate( "body", "scavenger_opening" );
        _id_C0858ACEEA4BB7D9 = getdvarint( "dvar_28B9017071772839", 30 );
        instance.entity scripts\engine\utility::_id_AD9433AAB9FCDF04( _id_C0858ACEEA4BB7D9, "death_or_disconnect", ::delete );
        items = getscriptablelootcachecontents( instance, _id_B8EBE3F71A08AB40._id_003BB6053DB23449 );

        if ( isdefined( items ) )
        {
            _id_CB4FAD49263E20C4 = spawnstruct();
            _id_CB4FAD49263E20C4.origin = instance.origin;
            _id_CB4FAD49263E20C4.angles = instance.angles;
            _id_CB4FAD49263E20C4.itemsdropped = 0;
            _id_605079299D001231 = _id_CB4FAD49263E20C4 _id_552B8E4EA5FF7DF1::lootspawnitemlist( items, 1 );

            foreach ( item in _id_605079299D001231 )
                item.team = player.team;
        }

        players = scripts\mp\utility\teams::getteamdata( _id_B8EBE3F71A08AB40.teams[0], "players" );
        _id_B8EBE3F71A08AB40._id_003BB6053DB23449++;

        if ( _id_B8EBE3F71A08AB40._id_003BB6053DB23449 < level._id_CF05AFB32024800A._id_697B16D5E1CB65E3 )
        {
            _id_64ACB6CE534155B7::displaysquadmessagetoteam( _id_B8EBE3F71A08AB40.teams[0], player, 7, _id_64ACB6CE534155B7::getquestindex( "scavenger" ) );
            _id_8FF7906AC676E086 = undefined;

            foreach ( _id_18FBB9618444B836 in _id_B8EBE3F71A08AB40._id_3B1ED2AB5FEE3E31 )
            {
                if ( _id_18FBB9618444B836.cacheentity == instance.entity )
                    _id_8FF7906AC676E086 = _id_18FBB9618444B836;
            }

            _id_8FF7906AC676E086._id_3B991F00E2E091E4 = 1;
            _id_8FF7906AC676E086 _id_64ACB6CE534155B7::deletequestobjicon();
            _id_8FF7906AC676E086.objectiveiconid = undefined;
        }
        else
        {
            _id_64ACB6CE534155B7::displaysquadmessagetoteam( _id_B8EBE3F71A08AB40.teams[0], player, 8, _id_64ACB6CE534155B7::getquestindex( "scavenger" ) );
            rewards = _id_64ACB6CE534155B7::_id_D212A5E7A40D7C8D( "scavenger", _id_B8EBE3F71A08AB40.teams[0] );

            if ( !_id_2CEDCC356F1B9FC8::istutorial() )
            {
                if ( isdefined( rewards ) && isdefined( rewards[0] ) )
                    _id_64ACB6CE534155B7::_id_878EBCC241B54505( "br_scavenger_quest_complete", _id_64ACB6CE534155B7::_id_3D262D56274BD22E( "scavenger" ), rewards[0], _id_B8EBE3F71A08AB40.teams[0] );

                level thread _id_2CEDCC356F1B9FC8::brleaderdialogteam( "mission_scav_success", _id_B8EBE3F71A08AB40.teams[0], 1, 1 );
            }

            _id_B8EBE3F71A08AB40 thread _id_810BBEDED8D1A801( 1 );
        }

        foreach ( player in players )
            player _id_64ACB6CE534155B7::uiobjectivesetparameter( _id_B8EBE3F71A08AB40._id_003BB6053DB23449 );

        _id_B8EBE3F71A08AB40 _id_64ACB6CE534155B7::_id_E2AA45E2C6B5DEC1( _id_B8EBE3F71A08AB40._id_003BB6053DB23449 );
        level notify( "lootcache_opened_kill_callout" + instance.origin );
        _id_96674628376EABA6 = [[ scripts\cp_mp\utility\script_utility::getsharedfunc( "game", "getFriendlyPlayers" ) ]]( player.team, 0 );

        foreach ( _id_F0EA4030349A33D5 in _id_96674628376EABA6 )
            _id_F0EA4030349A33D5 notify( "calloutmarkerping_warzoneKillQuestIcon" );
    }
}
