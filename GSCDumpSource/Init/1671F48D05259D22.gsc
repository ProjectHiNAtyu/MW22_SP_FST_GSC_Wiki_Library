// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

playercanpickupkillstreak()
{
    return !isdefined( self.brkillstreak );
}

takekillstreakpickup( pickupent )
{
    _id_608A1457B732069E = level.br_pickups.br_equipname[pickupent.scriptablename];
    self.brkillstreak = _id_608A1457B732069E;
    playerkillstreakhud( _id_608A1457B732069E );
    playergivetriggerweapon();
    thread playerhandlekillstreak( _id_608A1457B732069E );
}

playerkillstreakhud( streakname )
{
    self.brkillstreakhudlabel = scripts\mp\hud_util::createfontstring( "default", 0.75 );
    self.brkillstreakhudlabel scripts\mp\hud_util::setpoint( "CENTER", "BOTTOM LEFT", 270, -70 );
    self.brkillstreakhudlabel.label = &"MP/BR_ACTIVATE_KILLSTREAK";
    _id_D442547D75DFFD09 = level._id_0B23156D776B1D85._id_038F2A11237246AC[streakname];
    icon = scripts\engine\utility::ter_op( isdefined( _id_D442547D75DFFD09 ) && isdefined( _id_D442547D75DFFD09.hudicon ), _id_D442547D75DFFD09._id_80437C37A4E0AA29, "" );
    self.brkillstreakhudicon = scripts\mp\hud_util::createicon( icon, 30, 30 );
    self.brkillstreakhudicon scripts\mp\hud_util::setpoint( "CENTER", "BOTTOM LEFT", 270, -45 );
}

playergivetriggerweapon()
{
    self giveweapon( "super_default_mp" );
    self setweaponammoclip( "super_default_mp", 1 );
    self assignweaponoffhandspecial( "super_default_mp" );
}

playerhandlekillstreak( _id_608A1457B732069E )
{
    self endon( "disconnect" );
    level endon( "game_ended" );

    for (;;)
    {
        self waittill( "special_weapon_fired", objweapon );
        result = playertriggerkillstreak();

        if ( result )
        {
            playerremovekillstreak();
            return;
        }
        else
            self setweaponammoclip( "super_default_mp", 1 );
    }
}

playertriggerkillstreak()
{
    if ( !isalive( self ) )
        return 0;

    struct = scripts\mp\killstreaks\killstreaks::createstreakitemstruct( self.brkillstreak );
    result = scripts\mp\killstreaks\killstreaks::triggerkillstreak( struct );
    return istrue( result );
}

playerremovekillstreak()
{
    self takeweapon( "super_default_mp" );
    self.brkillstreak = undefined;

    if ( isdefined( self.brkillstreakhudlabel ) )
        self.brkillstreakhudlabel destroy();

    if ( isdefined( self.brkillstreakhudicon ) )
        self.brkillstreakhudicon destroy();
}

dangernotifyplayersinrange( notifyorigin, _id_89C35EB8C5FACCED, _id_1022173EA86A7090, _id_BEB9E876857446FC )
{
    playersinrange = scripts\common\utility::playersincylinder( notifyorigin, _id_89C35EB8C5FACCED );

    if ( !isdefined( _id_BEB9E876857446FC ) )
        _id_BEB9E876857446FC = 1;

    foreach ( player in playersinrange )
    {
        if ( isdefined( player ) && scripts\mp\utility\player::isreallyalive( player ) && player.team != self.team )
            dangernotifyplayer( player, _id_1022173EA86A7090, _id_BEB9E876857446FC );
    }
}

dangernotifyplayer( player, _id_1022173EA86A7090, _id_BEB9E876857446FC, _id_334D3B08AEF373D4 )
{
    if ( isdefined( level._id_5A81CD5A6AE1C552 ) && isdefined( level._id_ED3BBED90E848793 ) )
    {
        if ( isdefined( level._id_ED3BBED90E848793[_id_1022173EA86A7090] ) && isdefined( level._id_ED3BBED90E848793[_id_1022173EA86A7090][player.guid] ) && gettime() < level._id_ED3BBED90E848793[_id_1022173EA86A7090][player.guid] )
            _id_BEB9E876857446FC = 0;
        else
            level._id_ED3BBED90E848793[_id_1022173EA86A7090][player.guid] = gettime() + level._id_5A81CD5A6AE1C552 * 1000;
    }

    if ( istrue( _id_BEB9E876857446FC ) )
    {
        _id_F7D3D70AA19E5297 = _id_2CEDCC356F1B9FC8::brgetoperatorteam( self );
        dialog = _id_F7D3D70AA19E5297 + "_enemy_" + _id_1022173EA86A7090 + "_inbound";
        player scripts\mp\utility\dialog::leaderdialogonplayer( dialog, "killstreak_used" );
    }

    switch ( _id_1022173EA86A7090 )
    {
        case "toma_strike":
            _id_1022173EA86A7090 = 1;
            break;
        case "precision_airstrike":
            _id_1022173EA86A7090 = 2;
            break;
        case "gulag_closed":
            _id_1022173EA86A7090 = 3;
            break;
        case "cash_deploy_closed":
            _id_1022173EA86A7090 = 4;
            break;
        case "respawn_disabled":
            _id_1022173EA86A7090 = 5;
            break;
        default:
            _id_1022173EA86A7090 = 0;
            break;
    }

    if ( _id_1022173EA86A7090 > 0 )
    {
        player setclientomnvar( "ui_br_danger_warning", _id_1022173EA86A7090 );
        dangernotifyresetforplayer( player, _id_334D3B08AEF373D4 );
    }
}

dangernotifyresetforplayer( player, _id_334D3B08AEF373D4 )
{
    playerid = player getxuid();

    if ( !isdefined( _id_334D3B08AEF373D4 ) )
        _id_334D3B08AEF373D4 = 4;

    level notify( "danger_notify_start_" + playerid );
    level thread watchdangerresetaction( player, playerid, "death_or_disconnect" );
    level thread watchdangerresetaction( player, playerid, undefined, _id_334D3B08AEF373D4 );
}

watchdangerresetaction( player, playerid, action, timeout )
{
    level endon( "danger_notify_start_" + playerid );
    level endon( "danger_notify_finished_" + playerid );
    level endon( "game_ended" );

    if ( isdefined( action ) )
        player waittill( action );
    else if ( isdefined( timeout ) )
        wait( timeout );

    if ( isdefined( player ) )
        player setclientomnvar( "ui_br_danger_warning", 0 );

    level notify( "danger_notify_finished_" + playerid );
}
