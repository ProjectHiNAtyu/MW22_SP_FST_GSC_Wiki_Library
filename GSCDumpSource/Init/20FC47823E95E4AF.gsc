// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

_id_C96F19C0BEBDC014()
{
    _id_AED74300DAF62896 = spawnstruct();
    _id_AED74300DAF62896._id_B586C70B173DD02B = [];
    _id_AED74300DAF62896.name = "chopper";
    _id_AED74300DAF62896._id_EC2EC5F083DF61CD = ::_id_A98B4087642D8E07;
    _id_AED74300DAF62896.spawnfunc = ::_id_369A1DFB674D9262;
    _id_AED74300DAF62896._id_E68429B39C75B6EE = ::_id_369A1DFB674D9262;
    _id_AED74300DAF62896._id_7232C52496C3A94A = ::_id_463307A73B2CD8DF;
    _id_2FDEB8023287BE67::_id_469ECEAE21900C7D( _id_AED74300DAF62896, "additive", 1 );
    _id_2FDEB8023287BE67::_id_613E13E7416BFAA5( _id_AED74300DAF62896 );
}

_id_A98B4087642D8E07( _id_AED74300DAF62896 )
{
    level._id_0D44040648E9624F = getdvarint( "dvar_2E1A1EE4432BA896", 4000 );
    level._id_426503BD899FE79D = getdvarint( "dvar_F8CFA0A3E3979732", 5000 );
    level._id_8B0166C08F79BA6F = getdvarint( "dvar_0FB9F16D91BCC8A8", 420 );
    level._id_6884E659BD874ED9 = getdvarint( "dvar_29C7A74C7B9DD1B2", 3 );
    level._id_920D2D352811F372 = getdvarint( "dvar_4E73BB68DF397FBF", 6 );
    level._id_EDA461803CDADC2C = getdvarint( "dvar_995DD383D134E9ED", 0 );
    level._id_FDD8206D27C6E843 = getdvarint( "dvar_7926DA00AFDCD474", 4500 );
    level._id_147A8BCA293848EA = getdvarint( "dvar_87A6941B45C05399", 6 );
    level._id_F787CF36B2E0E7F7 = getdvarint( "dvar_369E173B0E8D08BA", 10 );
    level._id_050B14458069E6DE = getdvarint( "dvar_8B1842E92794C807", 4 );
    level._id_26C9EB02A050F11A = getdvarint( "dvar_CC7FEB01EAE01A3F", 1 );
    level._id_E21F87900A38B4E0 = getdvarint( "dvar_2B111045E5D27399", 200 );
    level._id_E21F8A900A38BB79 = getdvarint( "dvar_2B110D45E5D26D00", 150 );
    level._id_E21F89900A38B946 = getdvarint( "dvar_2B110E45E5D26F33", 100 );
    level._id_80D62FADB785EC94 = [ "saba_moderncity" ];
    level.averagealliesz = 0;
    level.killstreakweaponmap["chopper_gunner_proj_dmz"] = "chopper_gunner";
}

_id_369A1DFB674D9262()
{
    if ( getdvarint( "dvar_E8345A47ED69D00A", 1 ) != 1 )
        return;

    level thread _id_289402BE40270FB7();
}

_id_289402BE40270FB7()
{
    instance = _id_2FDEB8023287BE67::_id_2E6E2B664DFE3186( "chopper" );
    instance.spawned = 0;
    keys = getarraykeys( level._id_ACF99124377543BB );
    keys = scripts\engine\utility::array_randomize( keys );

    foreach ( key in keys )
    {
        if ( scripts\engine\utility::array_find( level._id_80D62FADB785EC94, key ) == undefined )
        {
            instance._id_91403901A31FA2F8 = key;
            break;
        }
    }

    if ( !isdefined( instance._id_91403901A31FA2F8 ) )
        instance._id_91403901A31FA2F8 = scripts\engine\utility::_id_F1164393DAC4665A( level._id_ACF99124377543BB );

    instance._id_FB1DEF007972B25A = level._id_ACF99124377543BB[instance._id_91403901A31FA2F8];
    instance scripts\cp_mp\utility\game_utility::_id_6B6B6273F8180522( "Boss_Dmz", instance._id_FB1DEF007972B25A, 6000 );
    scripts\mp\flags::gameflagwait( "prematch_done" );
    wait( level._id_8B0166C08F79BA6F );
    instance _id_3EAD0708199BA214();
}

_id_B12B6F997C04F0D0()
{
    for (;;)
    {
        waitframe();

        if ( getdvarint( "dvar_4CAEED66C64F0E35", 0 ) == 1 )
        {
            pos = level.players[0].origin;
            _id_978010E5FF5D52BC( pos );
            setdvar( "dvar_4CAEED66C64F0E35", 0 );
        }
    }
}

_id_3EAD0708199BA214()
{
    _id_171F90B9C4C76D44 = self._id_91403901A31FA2F8;

    if ( !isdefined( level._id_ACF99124377543BB ) || !scripts\engine\utility::array_contains_key( level._id_ACF99124377543BB, _id_171F90B9C4C76D44 ) )
        return;

    chopper = _id_978010E5FF5D52BC( self._id_FB1DEF007972B25A );
    self.spawned = 1;
    scripts\cp_mp\utility\game_utility::_id_AF5604CE591768E1();

    foreach ( team in self._id_7D8AD21E5DFD7C94 )
        scripts\mp\objidpoolmanager::objective_teammask_addtomask( self.objidnum, team );

    thread _id_67FE145BDE788912( self._id_FB1DEF007972B25A, _id_171F90B9C4C76D44 );
}

_id_978010E5FF5D52BC( pos )
{
    chopper = _id_784AA75D4A32FA24::_id_4C4DF9AEB773709A( pos, "veh_airdrop_escort_dmz", "veh9_mil_air_heli_hind_dmz_weapons", level._id_0D44040648E9624F, "dmz_boss_chopper" );
    chopper._id_980D543A9814A36F = 10;
    chopper._id_D31810C7EB37ABFE = 500;
    chopper._id_CD2FA7E9B25262D0 = chopper._id_D31810C7EB37ABFE;
    chopper.currenthealth = level._id_426503BD899FE79D;
    chopper.health = level._id_426503BD899FE79D;
    chopper.maxhealth = level._id_426503BD899FE79D;
    chopper.lootfunc = ::_id_4AD380A5E1B9C51A;
    chopper._id_ECBC9CD30D3DB0BE = [];
    chopper.combatstate = 0;
    chopper.shouldshoot = 1;
    chopper._id_E0BF649E3B37455D = 0;
    chopper._id_C6C4017B9F56BFF4 = ::_id_C23BF5E680C0B0FC;
    chopper._id_F09811D8BB92DF96 = ::_id_80EB9BA6D517FEFE;
    chopper._id_59BCC0EE54CDB593 = ::_id_A5298692F21A8421;
    chopper.funcs["strafe"] = ::_id_0C1FEEB5592D1018;
    chopper._id_580BA3BE57AF233E = 0;
    chopper._id_902492553F7C3DAF = makeweapon( "chopper_gunner_proj_dmz" );
    chopper hidepart( "tag_main_rotor_blade_01", "veh9_mil_air_heli_hind_dmz" );
    chopper hidepart( "tag_main_rotor_blade_02", "veh9_mil_air_heli_hind_dmz" );
    chopper hidepart( "tag_main_rotor_blade_03", "veh9_mil_air_heli_hind_dmz" );
    chopper hidepart( "tag_main_rotor_blade_04", "veh9_mil_air_heli_hind_dmz" );
    chopper hidepart( "tag_main_rotor_blade_05", "veh9_mil_air_heli_hind_dmz" );
    chopper hidepart( "tag_tail_rotor_blade_01", "veh9_mil_air_heli_hind_dmz" );
    chopper hidepart( "tag_tail_rotor_blade_02", "veh9_mil_air_heli_hind_dmz" );
    chopper hidepart( "tag_tail_rotor_static", "veh9_mil_air_heli_hind_dmz" );
    chopper hidepart( "tag_main_rotor_static", "veh9_mil_air_heli_hind_dmz" );
    chopper thread _id_7D5210C8E3520F4C();
    self.chopper = chopper;
    _id_2FDEB8023287BE67::_id_8002B09B8348902C( pos, "ui_map_icon_boss_chopper" );
    scripts\mp\objidpoolmanager::update_objective_onentity( self.objidnum, chopper );
    thread _id_37985716C0079C86();

    if ( isdefined( level._id_D8D4808549090419 ) )
        [[ level._id_D8D4808549090419 ]]( chopper );

    return chopper;
}

_id_37985716C0079C86()
{
    self.chopper waittill( "death" );
    scripts\mp\gameobjects::releaseid();
}

_id_80EB9BA6D517FEFE( player )
{
    if ( isdefined( player ) && isdefined( player.team ) && scripts\cp_mp\utility\player_utility::isreallyalive( player ) && isdefined( self._id_ECBC9CD30D3DB0BE[player.team] ) && self._id_ECBC9CD30D3DB0BE[player.team] >= level._id_147A8BCA293848EA )
        return 1;

    return 0;
}

_id_C23BF5E680C0B0FC( data )
{
    scripts\cp_mp\killstreaks\chopper_support::_id_400022DABDB64055( data );

    switch ( self.damagestate )
    {
        case 0:
            if ( self.currenthealth < level._id_426503BD899FE79D * 0.8 )
            {
                self.damagestate = 1;
                self setscriptablepartstate( "body_damage_light", "on", 0 );
                self setscriptablepartstate( "damage_left_wing", "on", 0 );
            }

            break;
        case 1:
            if ( self.currenthealth < level._id_426503BD899FE79D * 0.5 )
            {
                self.damagestate = 2;
                self setscriptablepartstate( "body_damage_medium", "on", 0 );
                self setscriptablepartstate( "damage_right_wing", "on", 0 );
            }

            break;
        case 2:
            if ( self.currenthealth < level._id_426503BD899FE79D * 0.25 )
            {
                self.damagestate = 3;
                self setscriptablepartstate( "body_damage_heavy", "on", 0 );
            }

            break;
        case 3:
        default:
            break;
    }

    if ( !self.combatstate )
        _id_4B35485C0AF17453();

    if ( isdefined( data.attacker ) && isplayer( data.attacker ) )
        self._id_ECBC9CD30D3DB0BE[data.attacker.team] = level._id_147A8BCA293848EA;

    return 1;
}

_id_31529A6224103B1A( data )
{
    scripts\cp_mp\killstreaks\chopper_support::choppersupport_handledeathdamage( data );
    _id_1F97A44D1761C919::_id_9793A81BC3BC19E9( "boss_chopper_eliminated", data.attacker.team );
    self notify( "death" );
    return 1;
}

_id_7D5210C8E3520F4C()
{
    self endon( "death" );
    level endon( "game_ended" );

    while ( !self.combatstate )
    {
        players = scripts\common\utility::_id_2D7FD59D039FA69B( self.origin, level._id_FDD8206D27C6E843, 1 );
        _id_694236C50BB536FE = [];

        foreach ( player in players )
        {
            if ( !isdefined( _id_694236C50BB536FE[player.team] ) )
            {
                _id_694236C50BB536FE[player.team] = 1;

                if ( !isdefined( self._id_ECBC9CD30D3DB0BE[player.team] ) )
                    self._id_ECBC9CD30D3DB0BE[player.team] = 0;

                self._id_ECBC9CD30D3DB0BE[player.team]++;

                if ( self._id_ECBC9CD30D3DB0BE[player.team] >= level._id_147A8BCA293848EA )
                    _id_4B35485C0AF17453();
            }
        }

        self setscriptablepartstate( "speaker", "idle", 0 );
        wait 1;
        self setscriptablepartstate( "speaker", "warning", 0 );
        wait 9;
    }
}

_id_4B35485C0AF17453()
{
    self.combatstate = 1;
    thread _id_E20F2BA1DCB6F312();
}

_id_E20F2BA1DCB6F312()
{
    self endon( "death" );
    level endon( "game_ended" );

    for (;;)
    {
        self setscriptablepartstate( "speaker", "idle", 0 );
        wait 1;
        self setscriptablepartstate( "speaker", "attacking", 0 );
        wait 9;
    }
}

_id_67FE145BDE788912( _id_EB4D81FD840007E2, _id_171F90B9C4C76D44 )
{
    if ( level._id_EDA461803CDADC2C < 0 )
        return;

    if ( level._id_EDA461803CDADC2C > 0 )
    {
        playerlist = [];

        foreach ( player in level.players )
        {
            if ( distance2dsquared( player.origin, _id_EB4D81FD840007E2 ) < level._id_EDA461803CDADC2C )
                playerlist[playerlist.size] = player;
        }
    }
    else
        playerlist = level.players;

    teamlist = [];

    foreach ( player in playerlist )
    {
        if ( !scripts\engine\utility::array_contains( teamlist, player.team ) )
            teamlist[teamlist.size] = player.team;
    }

    foreach ( team in teamlist )
        _id_463307A73B2CD8DF( team );

    _id_1F97A44D1761C919::_id_D87D5DEB069BF8E5( "boss_chopper_near", playerlist );
}

_id_4AD380A5E1B9C51A()
{
    crate = _id_046CF752D93DC17B::_id_52F17E5FBEC318A6( self.origin, level._id_EF63E063E320ACFC["dmz_boss_drop"], self.origin );

    if ( isdefined( crate ) )
    {
        crate unlink();
        crate physicslaunchserver( ( 0, 0, 0 ), ( 0, 0, 0 ) );
        _id_212A44A5393C3B34 = crate physics_getbodyid( 0 );
        physics_setbodycenterofmassnormal( _id_212A44A5393C3B34, ( 0, 0, -1 ) );
        crate.physicsactivated = 1;
        crate.usetime = 10;
        crate setscriptablepartstate( "dmz_supply_drop", "usable" );
    }

    if ( !_id_4480C6CE37B2BDF3::_id_FC1CE25282BCBA83() )
    {
        _id_203302B9AC91E7F4 = _id_7E52B56769FA7774::getitemdroporiginandangles( 1, self.origin, self.angles, self );
        _id_203302B9AC91E7F4.instance = self.instance;
        _id_4480C6CE37B2BDF3::_id_1BAFB1F579534EF6( _id_203302B9AC91E7F4 );
    }
}

_id_A5298692F21A8421( target )
{
    self endon( "death" );
    self endon( "crashing" );
    self endon( "state_change" );
    _id_40130BD790669C04 = target.origin;
    self.shouldshoot = 1;
    self._id_E0BF649E3B37455D = 0;
    thread _id_D105B5766895909D( target );

    for (;;)
    {
        self setturrettargetvec( target.origin );

        if ( _id_DD5CA63B6CA176B8( target ) )
        {
            if ( self._id_580BA3BE57AF233E > level._id_6884E659BD874ED9 )
            {
                if ( level._id_920D2D352811F372 > 0 )
                    _id_784AA75D4A32FA24::_id_9F656E924A854C1B( target, 4000, 8, randomint( 360 ), 1000 );
                else
                    _id_E278235100ED92F4( target );
            }
            else
            {
                _id_E278235100ED92F4( target );

                if ( level._id_920D2D352811F372 > 0 )
                    _id_784AA75D4A32FA24::_id_9F656E924A854C1B( target, 4000, 8, randomint( 360 ), 1000 );
            }
        }

        if ( !isdefined( target ) || !scripts\cp_mp\utility\player_utility::isreallyalive( target ) )
        {
            _id_784AA75D4A32FA24::_id_7743AEFF79A08975( "idle" );
            return;
        }

        if ( distance2dsquared( _id_40130BD790669C04, target.origin ) > 100000000 )
        {
            _id_784AA75D4A32FA24::_id_03BE784D69CC30A0( target, -800 );
            _id_784AA75D4A32FA24::_id_7743AEFF79A08975( "idle" );
            return;
        }

        wait 3;
    }
}

_id_0C1FEEB5592D1018( target )
{
    self._id_580BA3BE57AF233E = 0;
    _id_46DA84E8CED274E2 = [ "tag_gun_right1", "tag_gun_left1", "tag_gun_right2", "tag_gun_left2" ];
    wait 1;

    for ( _id_AC0E594AC96AA3A8 = 0; _id_AC0E594AC96AA3A8 < level._id_920D2D352811F372; _id_AC0E594AC96AA3A8++ )
    {
        _id_0429AAE2E6E20F85 = self gettagorigin( _id_46DA84E8CED274E2[_id_AC0E594AC96AA3A8 % 4] ) + anglestoforward( self.angles ) * 200;
        _id_85FA3CDCB19D2A9C = self gettagorigin( _id_46DA84E8CED274E2[_id_AC0E594AC96AA3A8 % 4] ) + anglestoforward( self.angles ) * 1000;
        missile = scripts\cp_mp\utility\weapon_utility::_magicbullet( self._id_902492553F7C3DAF, _id_0429AAE2E6E20F85, _id_85FA3CDCB19D2A9C );
        wait 0.3;
    }
}

_id_D105B5766895909D( target )
{
    self endon( "death" );
    self endon( "crashing" );
    self endon( "state_change" );
    target endon( "death_or_disconnect" );
    self setlookatent( target );
    _id_29AE2ED56E057510 = 0;

    for (;;)
    {
        if ( !istrue( self._id_652BF3292E2A7755 ) )
        {
            _id_C3FBB6661B91750F = scripts\engine\trace::create_contents( 0, 1, 0, 1, 0, 0, 0, 1, 1 );
            canseetarget = scripts\engine\trace::ray_trace_passed( target.origin, self.origin, self.ignorelist, _id_C3FBB6661B91750F );

            if ( !canseetarget || distance2dsquared( target.origin, self.origin ) > 20250000 || distance2dsquared( target.origin, self.origin ) < 2250000 )
            {
                if ( !_id_784AA75D4A32FA24::_id_E9CB677B6BA63162( target, 3000, 8 ) )
                {
                    _id_29AE2ED56E057510++;

                    if ( _id_29AE2ED56E057510 > level._id_26C9EB02A050F11A )
                        self._id_E0BF649E3B37455D = 1;

                    if ( _id_29AE2ED56E057510 > level._id_050B14458069E6DE )
                        self.shouldshoot = 0;

                    if ( _id_29AE2ED56E057510 > level._id_F787CF36B2E0E7F7 )
                    {
                        _id_784AA75D4A32FA24::_id_03BE784D69CC30A0( target, -500 );
                        _id_784AA75D4A32FA24::_id_7743AEFF79A08975( "idle" );
                    }
                }
            }
            else
            {
                self._id_E0BF649E3B37455D = 0;
                self.shouldshoot = 1;
            }
        }

        wait 0.5;
    }
}

_id_E278235100ED92F4( target )
{
    self endon( "death" );
    self endon( "crashing" );
    self endon( "state_change" );
    _id_B0B68854AE03B4D7 = level._id_E21F87900A38B4E0;
    _id_795D7F662BA7E1A1 = 0;
    self._id_D706B7E51984C2EC = undefined;
    self._id_580BA3BE57AF233E++;
    dir = anglestoforward( target.angles );
    _id_6EF6398383AE0CF6 = vectornormalize( ( dir[0], dir[1], 0 ) );

    for ( _id_AC0E594AC96AA3A8 = 0; _id_AC0E594AC96AA3A8 < 100; _id_AC0E594AC96AA3A8++ )
    {
        if ( self.health < 0 )
            return;

        if ( scripts\cp_mp\utility\player_utility::isreallyalive( target ) && istrue( target.inlaststand ) )
        {
            _id_784AA75D4A32FA24::_id_03BE784D69CC30A0( target, -2000 );
            _id_784AA75D4A32FA24::_id_7743AEFF79A08975( "idle" );
            return;
        }

        if ( _id_AC0E594AC96AA3A8 == 40 )
            _id_B0B68854AE03B4D7 = level._id_E21F8A900A38BB79;
        else if ( _id_AC0E594AC96AA3A8 == 80 )
            _id_B0B68854AE03B4D7 = level._id_E21F89900A38B946;

        if ( self._id_E0BF649E3B37455D && !isdefined( self._id_D706B7E51984C2EC ) )
        {
            self._id_D706B7E51984C2EC = _id_B0B68854AE03B4D7;
            _id_795D7F662BA7E1A1 = 50;
            _id_B0B68854AE03B4D7 = int( level._id_E21F87900A38B4E0 );
        }
        else if ( !self._id_E0BF649E3B37455D && isdefined( self._id_D706B7E51984C2EC ) )
        {
            _id_B0B68854AE03B4D7 = self._id_D706B7E51984C2EC;
            _id_795D7F662BA7E1A1 = 0;
            self._id_D706B7E51984C2EC = undefined;
        }

        if ( !self.shouldshoot )
        {
            wait 0.1;
            continue;
        }

        _id_01E2777328B6B536 = target gettagorigin( "j_spineupper" );
        _id_A0A41BA05E16FFE6 = randomint( _id_B0B68854AE03B4D7 ) + _id_795D7F662BA7E1A1;
        _id_9E5D403038E4C071 = randomint( 360 );
        x = _id_01E2777328B6B536[0] + _id_A0A41BA05E16FFE6 * cos( _id_9E5D403038E4C071 );
        y = _id_01E2777328B6B536[1] + _id_A0A41BA05E16FFE6 * sin( _id_9E5D403038E4C071 );
        z = _id_01E2777328B6B536[2];
        point = ( x, y, z );

        if ( self._id_CD2FA7E9B25262D0 > 0 )
        {
            point = point + _id_6EF6398383AE0CF6 * self._id_CD2FA7E9B25262D0;
            self._id_CD2FA7E9B25262D0 = self._id_CD2FA7E9B25262D0 - self._id_980D543A9814A36F;
        }

        self setturrettargetvec( point );
        wait 0.1;
        self fireweapon();
    }

    self._id_CD2FA7E9B25262D0 = self._id_D31810C7EB37ABFE;
}

_id_DD5CA63B6CA176B8( target )
{
    _id_97F0985016AA48CB = 0.8;
    _id_929AD65D451FFC68 = anglestoforward( self gettagangles( "tag_flash" ) );
    _id_EFA57ADC48838F9B = vectornormalize( target.origin - self gettagorigin( "tag_flash" ) );
    _id_FF53E400DD536B82 = vectordot( _id_929AD65D451FFC68, _id_EFA57ADC48838F9B );
    return _id_FF53E400DD536B82 >= _id_97F0985016AA48CB;
}

_id_6326EFAEA227C12A( turret )
{
    if ( isdefined( self.currenttarget ) && self.currenttarget == turret.attackingtarget )
    {
        self.currenttarget._id_5B7ED65D780010D7 = gettime();
        self.currenttarget = undefined;
    }

    if ( istrue( turret.targetbrokelos ) )
        turret.targetbrokelos = undefined;

    turret.attackingtarget = undefined;
    turret cleartargetentity();
    turret.groundtargetent unlink();
    turret notify( "lost_target" );
}

_id_463307A73B2CD8DF( team )
{
    if ( scripts\engine\utility::array_contains( self._id_7D8AD21E5DFD7C94, team ) )
        return 0;

    self._id_7D8AD21E5DFD7C94 = scripts\engine\utility::array_add( self._id_7D8AD21E5DFD7C94, team );
    players = scripts\mp\utility\teams::getteamdata( team, "players" );
    _id_AC4C51BF033F6323 = players;

    if ( !istrue( self.spawned ) )
    {
        foreach ( player in players )
            scripts\cp_mp\utility\game_utility::_id_CFD53C8F6878014F( player );
    }
    else
        scripts\mp\objidpoolmanager::objective_teammask_addtomask( self.objidnum, team );

    _id_171F90B9C4C76D44 = undefined;

    if ( _id_5DEF7AF2A9F04234::_id_47D356083884F913() )
        _id_171F90B9C4C76D44 = _id_5DEF7AF2A9F04234::_id_6CC445C02B5EFFAC( self._id_FB1DEF007972B25A, 1 );

    _id_1B4ADA49A21B51CA = scripts\engine\utility::ter_op( istrue( self.spawned ), "dmz_chopper_revealed", "dmz_chopper_revealed_circle" );
    _id_4480C6CE37B2BDF3::_id_AE6091699E25D8B4( _id_1B4ADA49A21B51CA, _id_AC4C51BF033F6323, _id_171F90B9C4C76D44 );
    return 1;
}
