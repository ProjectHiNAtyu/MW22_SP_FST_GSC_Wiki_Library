// IW9 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    level._id_644BC8D2FAA9B475 = [];
    scripts\engine\scriptable::scriptable_addusedcallbackbypart( "military_ammo_restock", ::ammorestock_used );

    if ( !isdefined( level.ammorestocklocs ) )
        level.ammorestocklocs = [];

    ammorestocklocs = getentarray( "ammo_restock_location", "targetname" );

    foreach ( loc in ammorestocklocs )
    {
        _id_FD5EF62C4BDE358E = getentarray( loc.target, "targetname" );

        if ( !istrue( level.useammorestocklocs ) || isdefined( scripts\cp_mp\utility\game_utility::getlocaleid() ) && isdefined( loc.script_noteworthy ) && loc.script_noteworthy != level.localeid )
        {
            foreach ( ent in _id_FD5EF62C4BDE358E )
            {
                if ( ent.classname == "script_model" )
                {
                    ent delete();
                    continue;
                }

                ent delete();
            }

            loc delete();
            continue;
        }

        _id_DB4C236B8AE8D47F( loc );
    }

    if ( isdefined( level.localeid ) && level.localeid == "locale_6" )
        ammorestock_customlocale6cleanup();

    foreach ( _id_D24A7EA5713CC597 in level.ammorestocklocs )
    {
        foreach ( _id_7242647EFDEBE760 in getentarray( _id_D24A7EA5713CC597.target, "targetname" ) )
        {
            if ( !_id_7242647EFDEBE760 isscriptable() )
                continue;

            if ( scripts\cp_mp\utility\game_utility::_id_0BEFF479639E6508() )
            {
                if ( getdvar( "dvar_9946861F4644413F", "ON" ) == "ON" )
                    _id_7242647EFDEBE760 setscriptablepartstate( "military_ammo_restock", "useable_on" );
                else if ( getdvar( "dvar_9946861F4644413F", "ON" ) == "OFF" )
                    _id_7242647EFDEBE760 setscriptablepartstate( "military_ammo_restock", "useable_on_no_icon" );
            }
            else if ( getdvar( "dvar_C95A149E3FB09E8C", "ON" ) == "ON" )
                _id_7242647EFDEBE760 setscriptablepartstate( "military_ammo_restock", "useable_on" );
            else if ( getdvar( "dvar_C95A149E3FB09E8C", "ON" ) == "OFF" )
                _id_7242647EFDEBE760 setscriptablepartstate( "military_ammo_restock", "useable_on_no_icon" );

            break;
        }
    }
}

_id_2AC210AF318CF38B( struct )
{
    loc = spawn( "script_model", struct.origin );
    loc.angles = struct.angles;
    loc setmodel( "military_ammo_restock_location" );
    _id_DB4C236B8AE8D47F( loc );
    return loc;
}

_id_DB4C236B8AE8D47F( loc )
{
    if ( !isdefined( level.ammorestocklocs ) )
        level.ammorestocklocs = [];

    loc.timeplayerused = [];
    level.ammorestocklocs[level.ammorestocklocs.size] = loc;
}

ammorestock_used( instance, part, state, player, _id_A5B2C541413AA895, _id_CC38472E36BE1B61 )
{
    instance setscriptablepartstate( part, "useable_on_no_icon" );

    if ( scripts\cp_mp\utility\game_utility::_id_0BEFF479639E6508() )
    {
        result = _id_42F888E2E819CC64( player, instance );

        if ( result == 1 )
        {
            if ( scripts\mp\flags::gameflag( "prematch_done" ) && ( getdvar( "dvar_7611A2790A0BF7FE", "" ) != "plunder" && getdvar( "dvar_7611A2790A0BF7FE", "" ) != "risk" ) )
            {
                thread ammorestock_disableusefortime( instance, player, 0.1 );
                thread _id_9F58210B67259AC8( player, instance, getdvarint( "dvar_C9F983ED98245328", 60 ) );
            }
            else
                thread ammorestock_disableusefortime( instance, player, 5 );
        }
        else if ( result == 0 )
            thread ammorestock_disableusefortime( instance, player, 0.1 );
        else
            thread ammorestock_disableusefortime( instance, player, 0.1 );
    }
    else
    {
        result = ammorestock_playeruse( player, instance );

        if ( result == 1 )
        {
            thread ammorestock_disableusefortime( instance, player, 0.1 );
            thread _id_9F58210B67259AC8( player, instance, getdvarint( "dvar_C9F983ED98245328", 60 ) );
        }
        else if ( result == 0 )
            thread ammorestock_disableusefortime( instance, player, 0.1 );
        else
            thread ammorestock_disableusefortime( instance, player, 0.1 );
    }
}

_id_AFAB07CF819C5ED4( guid )
{
    level._id_644BC8D2FAA9B475[guid] = undefined;
}

_id_9039BC1E302709D0( guid, instance )
{
    level._id_644BC8D2FAA9B475[guid][instance.index] = undefined;
}

_id_9F58210B67259AC8( player, instance, time )
{
    guid = player scripts\mp\utility\player::getuniqueid();
    level._id_644BC8D2FAA9B475[guid][instance.index] = 1;
    player scripts\engine\utility::waittill_notify_or_timeout( "death", time );

    if ( !isdefined( player ) || !scripts\mp\utility\player::isreallyalive( player ) )
        _id_AFAB07CF819C5ED4( guid );
    else
        _id_9039BC1E302709D0( guid, instance );
}

ammorestock_disableusefortime( scriptable, player, time )
{
    player endon( "disconnect" );
    scriptable disablescriptableplayeruse( player );
    wait( time );
    scriptable enablescriptableplayeruse( player );
}

ammorestock_playeruse( player, instance )
{
    player endon( "death_or_disconnect" );
    guid = player scripts\mp\utility\player::getuniqueid();

    if ( !isdefined( level._id_644BC8D2FAA9B475[guid] ) )
        level._id_644BC8D2FAA9B475[guid] = [];

    if ( isdefined( level._id_644BC8D2FAA9B475[guid][instance.index] ) )
    {
        player scripts\mp\hud_message::showerrormessage( "MP_INGAME_ONLY/AMMO_RESTOCK_ON_COOLDOWN" );
        return 2;
    }

    _id_12A372E8CAA042BB = player.primaryweapons;
    _id_50F783A5617F8940 = [];

    foreach ( item in _id_12A372E8CAA042BB )
    {
        if ( !scripts\mp\utility\weapon::ismeleeonly( item ) && !scripts\mp\utility\weapon::issuperweapon( item ) && !_id_2669878CF5A1B6BC::iskillstreakweapon( item ) && !scripts\mp\utility\weapon::isgamemodeweapon( item ) )
            _id_50F783A5617F8940[_id_50F783A5617F8940.size] = item;
    }

    _id_12A372E8CAA042BB = _id_50F783A5617F8940;
    _id_DF04395B59031A4D = 0;

    foreach ( weaponobj in _id_12A372E8CAA042BB )
    {
        if ( weaponmaxammo( weaponobj ) <= player getweaponammostock( weaponobj ) )
            _id_DF04395B59031A4D++;
    }

    if ( _id_DF04395B59031A4D == _id_12A372E8CAA042BB.size )
    {
        player scripts\mp\hud_message::showerrormessage( "MP_INGAME_ONLY/AMMO_RESTOCK_STOCK_FULL" );
        return 0;
    }
    else
    {
        foreach ( weaponobj in _id_12A372E8CAA042BB )
        {
            _id_CF4209C200F8BBF4 = scripts\mp\utility\weapon::getweapongroup( weaponobj );
            _id_662B420C8B2FCB2D = undefined;

            if ( scripts\mp\utility\weapon::issinglehitweapon( weaponobj ) )
                _id_662B420C8B2FCB2D = 1;
            else if ( _id_CF4209C200F8BBF4 == "weapon_sniper" )
                _id_662B420C8B2FCB2D = 1.5;
            else
                _id_662B420C8B2FCB2D = 3;

            if ( istrue( weaponobj.hasalternate ) )
            {
                _id_6890A4CE965BBA99 = weaponobj getaltweapon();
                _id_91093EF03654702C = weaponclass( _id_6890A4CE965BBA99 );

                if ( _id_91093EF03654702C == "grenade" )
                {
                    _id_26F669E2F4686446 = scripts\mp\weapons::getammooverride( _id_6890A4CE965BBA99 );
                    stockammo = player getweaponammostock( _id_6890A4CE965BBA99 );
                    _id_2AA9CAEF99C9AF77 = int( stockammo + _id_26F669E2F4686446 );
                    player setweaponammostock( _id_6890A4CE965BBA99, _id_2AA9CAEF99C9AF77 );
                }
                else if ( _id_6890A4CE965BBA99.type == "bullet" )
                {
                    if ( _id_91093EF03654702C == "spread" )
                    {
                        _id_26F669E2F4686446 = scripts\mp\weapons::getammooverride( _id_6890A4CE965BBA99 );
                        stockammo = player getweaponammostock( _id_6890A4CE965BBA99 );
                        _id_2AA9CAEF99C9AF77 = int( stockammo + _id_26F669E2F4686446 );
                        player setweaponammostock( _id_6890A4CE965BBA99, _id_2AA9CAEF99C9AF77 );
                    }
                }
                else
                {
                    _id_26F669E2F4686446 = scripts\mp\weapons::getammooverride( _id_6890A4CE965BBA99 );
                    stockammo = player getweaponammostock( _id_6890A4CE965BBA99 );
                    _id_2AA9CAEF99C9AF77 = int( stockammo + _id_26F669E2F4686446 );
                    player setweaponammostock( _id_6890A4CE965BBA99, _id_2AA9CAEF99C9AF77 );
                }
            }

            _id_26F669E2F4686446 = scripts\mp\weapons::getammooverride( weaponobj ) * _id_662B420C8B2FCB2D;
            stockammo = player getweaponammostock( weaponobj );
            _id_2AA9CAEF99C9AF77 = int( stockammo + _id_26F669E2F4686446 );
            _id_F05AA030D9FAF1B9 = scripts\mp\weapons::getammooverride( weaponobj );
            clipammo = player getweaponammoclip( weaponobj );

            if ( weaponobj.basename == "iw8_lm_dblmg_mp" )
            {
                player setweaponammoclip( weaponobj, clipammo + _id_F05AA030D9FAF1B9 );
                continue;
            }

            player setweaponammostock( weaponobj, _id_2AA9CAEF99C9AF77 );
        }
    }

    primary = player scripts\mp\equipment::getcurrentequipment( "primary" );

    if ( isdefined( primary ) )
        player scripts\mp\equipment::incrementequipmentammo( primary );

    _id_D7B9856A19F9B6B5 = player scripts\mp\equipment::getcurrentequipment( "secondary" );

    if ( isdefined( _id_D7B9856A19F9B6B5 ) )
        player scripts\mp\equipment::incrementequipmentammo( _id_D7B9856A19F9B6B5 );

    player _id_5762AC2F22202BA2::hudicontype( "br_ammo" );
    player playlocalsound( "iw9_support_box_use" );
    return 1;
}

_id_42F888E2E819CC64( player, instance )
{
    player endon( "death_or_disconnect" );
    guid = player scripts\mp\utility\player::getuniqueid();

    if ( !isdefined( level._id_644BC8D2FAA9B475[guid] ) )
        level._id_644BC8D2FAA9B475[guid] = [];

    if ( isdefined( level._id_644BC8D2FAA9B475[guid][instance.index] ) )
    {
        player scripts\mp\hud_message::showerrormessage( "MP_INGAME_ONLY/AMMO_RESTOCK_ON_COOLDOWN" );
        return 2;
    }

    _id_BF00BD1D7DA56C26 = 0;
    _id_509D86412C9D7426 = player getweaponslistprimaries();
    _id_50F783A5617F8940 = [];

    foreach ( item in _id_509D86412C9D7426 )
    {
        if ( !scripts\mp\utility\weapon::ismeleeonly( item ) && !scripts\mp\utility\weapon::issuperweapon( item ) && !_id_2669878CF5A1B6BC::iskillstreakweapon( item ) && !scripts\mp\utility\weapon::isgamemodeweapon( item ) )
            _id_50F783A5617F8940[_id_50F783A5617F8940.size] = item;
    }

    _id_12A372E8CAA042BB = _id_50F783A5617F8940;
    _id_DF04395B59031A4D = 0;

    foreach ( weaponobj in _id_509D86412C9D7426 )
    {
        _id_B928C399C807AC2E = _id_724736FCF0FB6604::br_ammo_type_for_weapon( weaponobj );

        if ( isdefined( _id_B928C399C807AC2E ) )
        {
            if ( level._id_E6EA72FC5E3FCD00[_id_B928C399C807AC2E] <= player getweaponammostock( weaponobj ) )
                _id_DF04395B59031A4D++;
        }
    }

    if ( _id_DF04395B59031A4D >= _id_12A372E8CAA042BB.size )
    {
        player scripts\mp\hud_message::showerrormessage( "MP_INGAME_ONLY/AMMO_RESTOCK_STOCK_FULL" );
        return 0;
    }
    else
    {
        if ( player scripts\mp\utility\killstreak::isjuggernaut() )
        {
            if ( !isdefined( _id_509D86412C9D7426 ) || _id_509D86412C9D7426.size == 0 )
            {
                minigun = player getcurrentweapon();
                _id_D0BAE9FA43B9E424 = player getcurrentweaponclipammo();
                _id_E21A1FE75EA20307 = weaponclipsize( minigun );

                if ( _id_D0BAE9FA43B9E424 < _id_E21A1FE75EA20307 )
                {
                    player setweaponammoclip( minigun, _id_E21A1FE75EA20307 );
                    player _id_5762AC2F22202BA2::hudicontype( "br_ammo" );
                    player playlocalsound( "iw9_support_box_use" );
                    return 1;
                }
            }
        }

        foreach ( _id_DE88CD14114C1E24 in _id_509D86412C9D7426 )
        {
            _id_B928C399C807AC2E = _id_724736FCF0FB6604::br_ammo_type_for_weapon( _id_DE88CD14114C1E24 );

            if ( isdefined( _id_B928C399C807AC2E ) )
            {
                if ( level._id_E6EA72FC5E3FCD00[_id_B928C399C807AC2E] <= player getweaponammostock( _id_DE88CD14114C1E24 ) )
                    continue;
            }

            if ( _id_DE88CD14114C1E24.isalternate && _id_2669878CF5A1B6BC::_id_DE04E13AB01E1A10( _id_DE88CD14114C1E24.underbarrel ) )
            {
                clipammo = weaponclipsize( _id_DE88CD14114C1E24 );
                _id_2AA9CAEF99C9AF77 = int( clipammo );
                player setweaponammoclip( _id_DE88CD14114C1E24, _id_2AA9CAEF99C9AF77 );
                continue;
            }
            else if ( _id_2669878CF5A1B6BC::isminigunweapon( _id_DE88CD14114C1E24 ) )
            {
                player setweaponammoclip( _id_DE88CD14114C1E24, _id_DE88CD14114C1E24.clipsize );
                continue;
            }
            else if ( !isdefined( _id_B928C399C807AC2E ) )
                continue;

            player _id_724736FCF0FB6604::br_give_weapon_clip( _id_DE88CD14114C1E24, 2 );
        }

        primary = player scripts\mp\equipment::getcurrentequipment( "primary" );

        if ( isdefined( primary ) )
            player scripts\mp\equipment::incrementequipmentammo( primary );

        _id_D7B9856A19F9B6B5 = player scripts\mp\equipment::getcurrentequipment( "secondary" );

        if ( isdefined( _id_D7B9856A19F9B6B5 ) )
            player scripts\mp\equipment::incrementequipmentammo( _id_D7B9856A19F9B6B5 );

        player _id_5762AC2F22202BA2::hudicontype( "br_ammo" );
        player playlocalsound( "iw9_support_box_use" );
        return 1;
    }
}

ammorestock_customlocale6cleanup()
{
    _id_79D6F370510C1F94 = [];
    _id_79D6F370510C1F94[0] = ( 15946, -71, -469 );
    _id_79D6F370510C1F94[1] = ( 16829, -8996, -333 );
    _id_79D6F370510C1F94[2] = ( 16531, -13847, -154 );
    _id_79D6F370510C1F94[3] = ( 24472, -14782, -134 );
    _id_79D6F370510C1F94[4] = ( 22373, -19948, -36 );
    _id_79D6F370510C1F94[5] = ( 18250, -2057, -439 );
    _id_79D6F370510C1F94[6] = ( 17549, -4262, -432 );
    _id_79D6F370510C1F94[7] = ( 19147, -11546, -257 );
    _id_79D6F370510C1F94[8] = ( 19845, -21990, -98 );
    _id_79D6F370510C1F94[9] = ( 19838, -18100, -23 );
    _id_79D6F370510C1F94[10] = ( 21978, -11276, -58 );

    foreach ( loc in level.ammorestocklocs )
    {
        _id_E24C6C7277A83762 = 0;

        foreach ( _id_41BACC270E368C94 in _id_79D6F370510C1F94 )
        {
            if ( _id_E24C6C7277A83762 )
                break;

            if ( distance2dsquared( loc.origin, _id_41BACC270E368C94 ) < 10000 )
                _id_E24C6C7277A83762 = 1;
        }

        if ( _id_E24C6C7277A83762 )
        {
            _id_FD5EF62C4BDE358E = getentarray( loc.target, "targetname" );

            foreach ( ent in _id_FD5EF62C4BDE358E )
            {
                if ( ent.classname == "script_model" )
                {
                    ent delete();
                    continue;
                }

                ent delete();
            }

            loc delete();
        }
    }
}
